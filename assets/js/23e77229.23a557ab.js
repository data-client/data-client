/*! For license information please see 23e77229.23a557ab.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[22992],{41535:(e,t)=>{var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),s=Symbol.for("react.context"),p=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,y={};function v(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||h}function k(){}function g(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||h}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},k.prototype=v.prototype;var b=g.prototype=new k;b.constructor=g,m(b,v.prototype),b.isPureReactComponent=!0;var N=Array.isArray,E=Object.prototype.hasOwnProperty,w={current:null},x={key:!0,ref:!0,__self:!0,__source:!0};function R(e,t,r){var a,o={},l=null,i=null;if(null!=t)for(a in void 0!==t.ref&&(i=t.ref),void 0!==t.key&&(l=""+t.key),t)E.call(t,a)&&!x.hasOwnProperty(a)&&(o[a]=t[a]);var s=arguments.length-2;if(1===s)o.children=r;else if(1<s){for(var p=Array(s),u=0;u<s;u++)p[u]=arguments[u+2];o.children=p}if(e&&e.defaultProps)for(a in s=e.defaultProps)void 0===o[a]&&(o[a]=s[a]);return{$$typeof:n,type:e,key:l,ref:i,props:o,_owner:w.current}}function P(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var S=/\/+/g;function O(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function q(e,t,a,o,l){var i=typeof e;"undefined"!==i&&"boolean"!==i||(e=null);var s=!1;if(null===e)s=!0;else switch(i){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case n:case r:s=!0}}if(s)return l=l(s=e),e=""===o?"."+O(s,0):o,N(l)?(a="",null!=e&&(a=e.replace(S,"$&/")+"/"),q(l,t,a,"",(function(e){return e}))):null!=l&&(P(l)&&(l=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(l,a+(!l.key||s&&s.key===l.key?"":(""+l.key).replace(S,"$&/")+"/")+e)),t.push(l)),1;if(s=0,o=""===o?".":o+":",N(e))for(var p=0;p<e.length;p++){var u=o+O(i=e[p],p);s+=q(i,t,a,u,l)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),p=0;!(i=e.next()).done;)s+=q(i=i.value,t,a,u=o+O(i,p++),l);else if("object"===i)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return s}function I(e,t,n){if(null==e)return e;var r=[],a=0;return q(e,r,"","",(function(e){return t.call(n,e,a++)})),r}function L(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var j={current:null},T={transition:null}},27378:(e,t,n)=>{n(41535)},3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>f});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),p=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=p(n),f=a,h=d["".concat(s,".").concat(f)]||d[f]||c[f]||o;return n?r.createElement(h,l(l({ref:t},u),{},{components:n})):r.createElement(h,l({ref:t},u))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var p=2;p<o;p++)l[p]=n[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},85427:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>o,metadata:()=>i,toc:()=>p});var r=n(87462),a=(n(27378),n(3905));n(65488),n(85162);const o={title:"GQLEndpoint"},l=void 0,i={unversionedId:"api/GQLEndpoint",id:"api/GQLEndpoint",title:"GQLEndpoint",description:"GQLEndpoint extends Endpoint",source:"@site/../docs/graphql/api/GQLEndpoint.md",sourceDirName:"api",slug:"/api/GQLEndpoint",permalink:"/graphql/api/GQLEndpoint",draft:!1,editUrl:"https://github.com/coinbase/rest-hooks/edit/master/docs/graphql/api/GQLEndpoint.md",tags:[],version:"current",lastUpdatedBy:"Nathaniel Tucker",lastUpdatedAt:1664586789,formattedLastUpdatedAt:"Oct 1, 2022",frontMatter:{title:"GQLEndpoint"},sidebar:"docs",previous:{title:"Authentication",permalink:"/graphql/auth"},next:{title:"Endpoint",permalink:"/graphql/api/Endpoint"}},s={},p=[{value:"Fetch Lifecycle",id:"fetch-lifecycle",level:2},{value:"Prepare Fetch",id:"prepare-fetch",level:2},{value:"url: string",id:"path",level:3},{value:"getRequestInit(body): RequestInit",id:"getRequestInit",level:3},{value:"getQuery(variables): string",id:"getQuery",level:3},{value:"getHeaders(headers: HeadersInit): HeadersInit",id:"getHeaders",level:3},{value:"Handle fetch",id:"handle-fetch",level:2},{value:"fetchResponse(input, init): Promise",id:"fetchResponse",level:3},{value:"parseResponse(response): Promise",id:"parseResponse",level:3},{value:"process(value, ...args): any",id:"process",level:3},{value:"Endpoint Life-Cycles",id:"endpoint-life-cycles",level:2},{value:"schema: Schema",id:"schema",level:3},{value:"dataExpiryLength?: number",id:"dataexpirylength",level:3},{value:"errorExpiryLength?: number",id:"errorexpirylength",level:3},{value:"errorPolicy?: (error: any) =&gt; &#39;soft&#39; | undefined",id:"errorpolicy",level:3},{value:"invalidIfStale: boolean",id:"invalidifstale",level:3},{value:"pollFrequency: number",id:"pollfrequency",level:3},{value:"getOptimisticResponse: (snap, ...args) =&gt; fakePayload",id:"getoptimisticresponse",level:3},{value:"update(normalizedResponseOfThis, ...args) =&gt; ({ endpointKey: (normalizedResponseOfEndpointToUpdate) =&gt; updatedNormalizedResponse) })",id:"update",level:3},{value:"extend(options): Endpoint",id:"extend",level:2}],u={toc:p};function c(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("admonition",{title:"extends",type:"info"},(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("inlineCode",{parentName:"p"},"GQLEndpoint")," extends ",(0,a.kt)("a",{parentName:"p",href:"/graphql/api/Endpoint"},"Endpoint"))),(0,a.kt)("h2",{id:"fetch-lifecycle"},"Fetch Lifecycle"),(0,a.kt)("p",null,"GQLEndpoint adds to Endpoint by providing customizations for a provided fetch method."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("em",{parentName:"li"},"Prepare fetch"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"url"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"#getRequestInit"},"getRequestInit()"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#getQuery"},"getQuery()")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#getHeaders"},"getHeaders()")))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("em",{parentName:"li"},"Perform fetch"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"#fetchResponse"},"fetchResponse()")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"#parseResponse"},"parseResponse()")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"#process"},"process()"))))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="fetch implementation for GQLEndpoint"',title:'"fetch',implementation:!0,for:!0,'GQLEndpoint"':!0},"async function fetch(variables) {\n  return this.fetchResponse(this.url, this.getRequestInit(variables)).then(\n    res => this.process(res, variables),\n  );\n}\n")),(0,a.kt)("h2",{id:"prepare-fetch"},"Prepare Fetch"),(0,a.kt)("p",null,"Members double as options (second constructor arg). While none are required, the first few\nhave defaults."),(0,a.kt)("h3",{id:"path"},"url: string"),(0,a.kt)("p",null,"GraphQL uses one url for all operations."),(0,a.kt)("h3",{id:"getRequestInit"},"getRequestInit(body): RequestInit"),(0,a.kt)("p",null,"Prepares ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch"},"RequestInit")," used in fetch.\nThis is sent to ",(0,a.kt)("a",{parentName:"p",href:"#fetchResponse"},"fetchResponse")),(0,a.kt)("h3",{id:"getQuery"},"getQuery(variables): string"),(0,a.kt)("p",null,"Prepare the query, to be sent as part of the body payload."),(0,a.kt)("h3",{id:"getHeaders"},"getHeaders(headers: HeadersInit): HeadersInit"),(0,a.kt)("p",null,"Called by ",(0,a.kt)("a",{parentName:"p",href:"#getRequestInit"},"getRequestInit")," to determine ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Request/headers"},"HTTP Headers")),(0,a.kt)("p",null,"This is often useful for ",(0,a.kt)("a",{parentName:"p",href:"../auth"},"authentication")),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"Don't use hooks here.")),(0,a.kt)("h2",{id:"handle-fetch"},"Handle fetch"),(0,a.kt)("h3",{id:"fetchResponse"},"fetchResponse(input, init): Promise"),(0,a.kt)("p",null,"Performs the ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API"},"fetch")," call"),(0,a.kt)("h3",{id:"parseResponse"},"parseResponse(response): Promise"),(0,a.kt)("p",null,"Takes the ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Response"},"Response")," and parses via .text() or .json()"),(0,a.kt)("h3",{id:"process"},"process(value, ...args): any"),(0,a.kt)("p",null,"Perform any transforms with the parsed result. Defaults to identity function."),(0,a.kt)("h2",{id:"endpoint-life-cycles"},"Endpoint Life-Cycles"),(0,a.kt)("h3",{id:"schema"},"schema: Schema"),(0,a.kt)("p",null,"Declarative definition of how to ",(0,a.kt)("a",{parentName:"p",href:"./schema"},"process responses")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"./schema"},"where")," to expect ",(0,a.kt)("a",{parentName:"li",href:"/graphql/api/Entity"},"Entities")),(0,a.kt)("li",{parentName:"ul"},"Classes to deserialize fields")),(0,a.kt)("p",null,"Not providing this option means no entities will be extracted."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"import { GQLEntity, GQLEndpoint } from '@rest-hooks/graphql';\nconst gql = new GQLEndpoint('https://nosy-baritone.glitch.me');\n\nclass User extends GQLEntity {\n  username = '';\n}\n\nexport const getUser = gql.query(\n  (v: { name: string }) => `query GetUser($name: String!) {\n    user(name: $name) {\n      id\n      name\n      email\n    }\n  }`,\n  { user: User },\n);\n")),(0,a.kt)("h3",{id:"dataexpirylength"},"dataExpiryLength?: number"),(0,a.kt)("p",null,"Custom data cache lifetime for the fetched resource. Will override the value set in NetworkManager."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"/docs/getting-started/expiry-policy#expiry-time"},"Learn more about expiry time")),(0,a.kt)("h3",{id:"errorexpirylength"},"errorExpiryLength?: number"),(0,a.kt)("p",null,"Custom data error lifetime for the fetched resource. Will override the value set in NetworkManager."),(0,a.kt)("h3",{id:"errorpolicy"},"errorPolicy?: (error: any) => 'soft' | undefined"),(0,a.kt)("p",null,"'soft' will use stale data (if exists) in case of error; undefined or not providing option will result\nin error."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"/docs/getting-started/expiry-policy#error-policy"},"Learn more about errorPolicy")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"errorPolicy(error) {\n  return error.status >= 500 ? 'soft' : undefined;\n}\n")),(0,a.kt)("h3",{id:"invalidifstale"},"invalidIfStale: boolean"),(0,a.kt)("p",null,"Indicates stale data should be considered unusable and thus not be returned from the cache. This means\nthat useSuspense() will suspend when data is stale even if it already exists in cache."),(0,a.kt)("h3",{id:"pollfrequency"},"pollFrequency: number"),(0,a.kt)("p",null,"Frequency in millisecond to poll at. Requires using ",(0,a.kt)("a",{parentName:"p",href:"/docs/api/useSubscription"},"useSubscription()")," to have\nan effect."),(0,a.kt)("h3",{id:"getoptimisticresponse"},"getOptimisticResponse: (snap, ...args) => fakePayload"),(0,a.kt)("p",null,"When provided, any fetches with this endpoint will behave as though the ",(0,a.kt)("inlineCode",{parentName:"p"},"fakePayload")," return value\nfrom this function was a succesful network response. When the actual fetch completes (regardless\nof failure or success), the optimistic update will be replaced with the actual network response."),(0,a.kt)("h3",{id:"update"},"update(normalizedResponseOfThis, ...args) => ({ ","[endpointKey]",": (normalizedResponseOfEndpointToUpdate) => updatedNormalizedResponse) })"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="UpdateType.ts"',title:'"UpdateType.ts"'},"type UpdateFunction<\n  Source extends EndpointInterface,\n  Updaters extends Record<string, any> = Record<string, any>,\n> = (\n  source: ResultEntry<Source>,\n  ...args: Parameters<Source>\n) => { [K in keyof Updaters]: (result: Updaters[K]) => Updaters[K] };\n")),(0,a.kt)("h2",{id:"extend"},"extend(options): Endpoint"),(0,a.kt)("p",null,"Can be used to further customize the endpoint definition"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"const gql = new GQLEndpoint('https://nosy-baritone.glitch.me');\n\nconst authGQL = gql.extend({\n  getHeaders(headers: HeadersInit): HeadersInit {\n    return {\n      ...headers,\n      'Access-Token': getAuth(),\n    };\n  },\n});\n")))}c.isMDXComponent=!0},85162:(e,t,n)=>{n.d(t,{Z:()=>l});var r=n(67294),a=n(86010);const o="tabItem_Ymn6";function l(e){let{children:t,hidden:n,className:l}=e;return r.createElement("div",{role:"tabpanel",className:(0,a.Z)(o,l),hidden:n},t)}},65488:(e,t,n)=>{n.d(t,{Z:()=>f});var r=n(87462),a=n(67294),o=n(86010),l=n(72389),i=n(67392),s=n(7094),p=n(12466);const u="tabList__CuJ",c="tabItem_LNqP";function d(e){var t,n;const{lazy:l,block:d,defaultValue:f,values:h,groupId:m,className:y}=e,v=a.Children.map(e.children,(e=>{if((0,a.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),k=null!=h?h:v.map((e=>{let{props:{value:t,label:n,attributes:r}}=e;return{value:t,label:n,attributes:r}})),g=(0,i.l)(k,((e,t)=>e.value===t.value));if(g.length>0)throw new Error(`Docusaurus error: Duplicate values "${g.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const b=null===f?f:null!=(t=null!=f?f:null==(n=v.find((e=>e.props.default)))?void 0:n.props.value)?t:v[0].props.value;if(null!==b&&!k.some((e=>e.value===b)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${b}" but none of its children has the corresponding value. Available values are: ${k.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:N,setTabGroupChoices:E}=(0,s.U)(),[w,x]=(0,a.useState)(b),R=[],{blockElementScrollPositionUntilNextRender:P}=(0,p.o5)();if(null!=m){const e=N[m];null!=e&&e!==w&&k.some((t=>t.value===e))&&x(e)}const S=e=>{const t=e.currentTarget,n=R.indexOf(t),r=k[n].value;r!==w&&(P(t),x(r),null!=m&&E(m,String(r)))},O=e=>{var t;let n=null;switch(e.key){case"ArrowRight":{var r;const t=R.indexOf(e.currentTarget)+1;n=null!=(r=R[t])?r:R[0];break}case"ArrowLeft":{var a;const t=R.indexOf(e.currentTarget)-1;n=null!=(a=R[t])?a:R[R.length-1];break}}null==(t=n)||t.focus()};return a.createElement("div",{className:(0,o.Z)("tabs-container",u)},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":d},y)},k.map((e=>{let{value:t,label:n,attributes:l}=e;return a.createElement("li",(0,r.Z)({role:"tab",tabIndex:w===t?0:-1,"aria-selected":w===t,key:t,ref:e=>R.push(e),onKeyDown:O,onFocus:S,onClick:S},l,{className:(0,o.Z)("tabs__item",c,null==l?void 0:l.className,{"tabs__item--active":w===t})}),null!=n?n:t)}))),l?(0,a.cloneElement)(v.filter((e=>e.props.value===w))[0],{className:"margin-top--md"}):a.createElement("div",{className:"margin-top--md"},v.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==w})))))}function f(e){const t=(0,l.Z)();return a.createElement(d,(0,r.Z)({key:String(t)},e))}}}]);