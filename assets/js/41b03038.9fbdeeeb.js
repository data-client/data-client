"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[45665],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,l=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=c(n),m=o,g=p["".concat(s,".").concat(m)]||p[m]||d[m]||l;return n?r.createElement(g,a(a({ref:t},u),{},{components:n})):r.createElement(g,a({ref:t},u))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var l=n.length,a=new Array(l);a[0]=p;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:o,a[1]=i;for(var c=2;c<l;c++)a[c]=n[c];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},84195:(e,t,n)=>{const r=(0,n(67294).createContext)({selectedValue:"",setSelectedValue:e=>{throw new Error("No Tab provider")},values:[]});t.Z=r},107:(e,t,n)=>{n.d(t,{Z:()=>D});var r=n(67294),o=n(87462),l=n(49544),a=n(86010),i=n(95999),s=n(52263),c=n(66412),u=n(84195),d=n(45440),p=n(75690);function m(e){let{fixtures:t}=e;return r.createElement("div",{className:d.Z.fixtureBlock},t.map((e=>r.createElement("div",{key:e.endpoint.key(...e.args),className:d.Z.fixtureItem},r.createElement("div",{className:d.Z.fixtureHeader},e.endpoint.key(...e.args)),r.createElement(f,{fixture:e})))))}var g=(0,r.memo)(m);function f(e){let{fixture:t}=e;return"function"==typeof t.response?"function":r.createElement(p.Z,{language:"json",className:d.Z.fixtureJson},JSON.stringify(t.response))}var h,b=n(60975),k=n(51523),y=n(1556);function v(){const{selectedValue:e,setSelectedValue:t,values:n}=(0,r.useContext)(u.Z);return r.createElement("div",{className:d.Z.tabs,role:"tablist","aria-orientation":"horizontal"},n.map((n=>{let{value:o,label:l}=n;return r.createElement("div",{role:"tab",tabIndex:e===o?0:-1,"aria-selected":e===o,key:o,className:(0,a.Z)(d.Z.tab,{[d.Z.selected]:e===o}),onFocus:t,onClick:t,value:o},l)})))}function E(e){let{children:t}=e;return r.createElement(b.Z,{className:d.Z.tabControls},r.createElement("div",{className:d.Z.title},t),r.createElement(v,null))}function x(e){let{title:t,fixtures:n}=e;const{values:o}=(0,r.useContext)(u.Z),l=o.length>0;return r.createElement(r.Fragment,null,n.length?r.createElement(r.Fragment,null,r.createElement(b.Z,{className:d.Z.small},"Fixtures"),r.createElement(g,{fixtures:n})):null,l?r.createElement(E,null,t):null)}function w(e){let{children:t,transformCode:n,groupId:i,defaultOpen:u,row:p,hidden:m,fixtures:g,includeEndpoints:f,...h}=e;const{liveCodeBlock:{playgroundPosition:b}}=(0,s.Z)().siteConfig.themeConfig,k=(0,c.p)();return r.createElement("div",{className:(0,a.Z)(d.Z.playgroundContainer,{[d.Z.row]:p,[d.Z.hidden]:m})},r.createElement(l.nu,(0,o.Z)({theme:k},h),r.createElement(Z,{reverse:"top"===b,row:p,fixtures:g,includeEndpoints:f,groupId:i,defaultOpen:u},t)))}function Z(e){let{reverse:t,children:n,row:o,fixtures:a,includeEndpoints:i,groupId:s,defaultOpen:c}=e;const u=(0,r.useMemo)((()=>"string"==typeof n?[{code:n.replace(/\n$/,""),collapsed:!1}]:(Array.isArray(n)?n:[n]).filter((e=>e.props.children)).map((e=>"string"==typeof e.props.children?e.props:e.props.children.props)).map((e=>{let{children:t,title:n="",collapsed:r=!1}=e;return{code:t.replace(/\n$/,""),title:n.replaceAll('"',""),collapsed:r}}))),[n]),[d,p]=(0,r.useReducer)(O,void 0,(()=>u.map((e=>{let{code:t}=e;return t})))),m=(0,r.useMemo)((()=>u.map(((e,t)=>e=>p({i:t,code:e})))),[u.length]),[g,f]=(0,r.useState)((()=>u.map((e=>{let{collapsed:t}=e;return t})))),h=d.join("\n");return r.createElement(C,{reverse:t},r.createElement("div",null,r.createElement(x,{fixtures:!o&&a}),o&&u.length>1?r.createElement(I,{titles:u.map((e=>{let{title:t}=e;return t})),closedList:g,onClick:e=>f((t=>t.map(((t,n)=>n!==e))))}):null,u.map(((e,t)=>{let{title:n}=e;return r.createElement(r.Fragment,{key:t},!o&&n?r.createElement(_,{onClick:()=>f((e=>{const n=[...e];return n[t]=!n[t],n})),closed:g[t],title:n}):null,g[t]?null:r.createElement(P,{key:t,onChange:m[t],code:d[t]}))}))),r.createElement(y.Z,{fallback:r.createElement(l.nu,{key:"preview",code:'render(() => "Loading...");',noInline:!0},r.createElement(k.Z,{key:"preview",includeEndpoints:i,groupId:s,defaultOpen:c,row:o,fixtures:a}))},r.createElement(N,{code:h,includeEndpoints:i,groupId:s,defaultOpen:c,row:o,fixtures:a})))}x.defaultProps={title:r.createElement(i.Z,{id:"theme.Playground.liveEditor",description:"The live editor label of the live codeblocks"},"Editor"),fixtures:[]},w.defaultProps={row:!1,hidden:!1};const T="object"==typeof navigator&&/bot|googlebot|crawler|spider|robot|crawling/i.test(null==(h=navigator)?void 0:h.userAgent),N=(0,r.lazy)((()=>T?Promise.resolve({default:e=>null}):Promise.all([n.e(87876),n.e(97277),n.e(26750)]).then(n.bind(n,47550))));function C(e){let{children:t,reverse:n}=e;const r=[...t];return r.reverse(),n?r:t}function O(e,t){const n=[...e];return n[t.i]=t.code,n}C.defaultProps={reverse:!1};const R=(0,r.memo)(l.uz);function P(e){let{onChange:t,code:n}=e;return r.createElement(R,{className:d.Z.playgroundEditor,onChange:t,code:n})}function _(e){let{onClick:t,closed:n,title:o}=e;return r.createElement(b.Z,{className:d.Z.small,onClick:t},r.createElement("span",{className:(0,a.Z)(d.Z.arrow,n?d.Z.right:d.Z.down)},"\u25b6"),o)}function I(e){let{titles:t,closedList:n,onClick:o}=e;const{values:l}=(0,r.useContext)(u.Z),i=l.length>0;return r.createElement(b.Z,{className:(0,a.Z)({[d.Z.small]:i,[d.Z.subtabs]:i},d.Z.noupper,d.Z.tabControls)},r.createElement("div",{className:d.Z.tabs,role:"tablist","aria-orientation":"horizontal"},t.map(((e,t)=>r.createElement("div",{role:"tab",key:t,onClick:()=>o(t),className:(0,a.Z)(d.Z.tab,{[d.Z.selected]:!n[t]})},e)))))}const S=e=>{let{children:t,groupId:n,hidden:o=!1,defaultOpen:l,row:a=!1,fixtures:i}=e;return r.createElement(w,{includeEndpoints:!Array.isArray(t),noInline:!0,groupId:n,defaultOpen:l,row:a,hidden:o,fixtures:i},"string"==typeof t||Array.isArray(t)?t:t.props.children)};S.defaultProps={defaultOpen:"n",fixtures:[]};var D=(0,r.memo)(S)},1556:(e,t,n)=>{n.d(t,{Z:()=>l});var r=n(91262),o=n(67294);function l(e){let{fallback:t,children:n}=e;return o.createElement(r.Z,{fallback:t},(()=>o.createElement(o.Suspense,{fallback:t},n)))}},60975:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(67294),o=n(86010),l=n(45440);function a(e){let{children:t,className:n,onClick:a}=e;return r.createElement("div",{className:(0,o.Z)(l.Z.playgroundHeader,n,a?l.Z.clickable:null),onClick:a},t)}},51523:(e,t,n)=>{n.d(t,{Z:()=>I});var r=n(67294),o=n(95999),l=n(27093),a=n(26127),i=n(82038),s=n(83611),c=n(39714),u=n(86010),d=n(7094),p=n(12466),m=n(45440),g=n(32041),f=n(97723),h=n(92949);function b(e){let{value:t}=e;const n="dark"===(0,h.I)().colorMode,o=(0,r.useMemo)((()=>({String:"rgb(195, 232, 141)",Date:"rgb(247, 140, 108)",Number:"rgb(247, 140, 108)",Boolean:"rgb(247, 140, 108)",Null:"rgb(255, 88, 116)",Undefined:"rgb(255, 88, 116)",Function:"rgb(247, 140, 108)",Symbol:"rgb(247, 140, 108)"})),[]),l=(0,r.useMemo)((()=>({tree:{overflow:"auto",flex:"4 1 70%",margin:0,padding:"0 0.5rem 0 0.8rem",backgroundColor:n?"var(--ifm-pre-background)":"rgb(41, 45, 62)",font:"var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace) !important",color:"rgb(227, 227, 227)"},arrowContainer:(e,t)=>{let{style:n}=e;return{style:{...n,fontFamily:"arial",padding:"7px 7px 7px 0",margin:"-7px calc(0.5em - 7px) -7px 0"}}},arrowSign:{color:"rgb(130, 170, 255)"},label:{color:"rgb(130, 170, 255)"},itemRange:{color:"rgb(105, 112, 152)"},valueText:(e,t)=>{let{style:n}=e;return{style:{...n,color:o[t]}}},base0B:"rgb(191, 199, 213)"})),[n,o]);return r.createElement(f.L,{shouldExpandNode:k,data:t,valueRenderer:v,theme:l,hideRoot:!0})}function k(e,t,n){return 0===n||(!(1!==n||!["entities","results"].includes(e[0]))||(2===n&&"entities"===e[1]||(2===n&&"results"===e[1]||(3===n&&"entities"===e[2]||3===n&&"results"===e[2]))))}const y="undefined"!=typeof Intl;function v(e,t){const n=arguments.length<=2?void 0:arguments[2];return y&&"number"==typeof t&&"string"==typeof n&&isFinite(t)&&("date"===n||n.endsWith("At"))?Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:3}).format(t):e}function E(e){let{toggle:t,selectedValue:n}=e;const o="y"===n,l=o?m.Z.right:m.Z.left;return r.createElement(r.Fragment,null,r.createElement("div",{className:m.Z.debugToggle,onClick:t},"Store",r.createElement("span",{className:(0,u.Z)(m.Z.arrow,l,m.Z.vertical)},"\u25b6")),o?r.createElement(Z,null):null)}var x=(0,r.memo)(E);function w(){const e=(0,r.useContext)(g.sA),t=(0,r.useMemo)((()=>{const t={...e};return delete t.optimistic,t}),[e]);return r.createElement(b,{value:t})}const Z=(0,r.memo)(w);var T=n(1556);function N(e){let{groupId:t,defaultOpen:n,row:o,fixtures:g}=e;const{tabGroupChoices:f,setTabGroupChoices:h}=(0,d.U)(),[b,k]=(0,r.useState)(n),{blockElementScrollPositionUntilNextRender:y}=(0,p.o5)();if(null!=t){const e=f[t];null!=e&&e!==b&&k(e)}const v=(0,r.useCallback)((e=>{y(e.currentTarget),k((e=>"y"===e?"n":"y")),h(t,"y"===b?"n":"y")}),[y,t,b,h]),E=(0,r.useMemo)((()=>[new s.Z,new l.Z(a.Z)]),[]),w=!("n"===b||!o);return r.createElement(i.nq,{managers:E},r.createElement(c.Z,{fixtures:g,silenceMissing:!0},r.createElement("div",{className:(0,u.Z)(m.Z.playgroundPreview,{[m.Z.hidden]:w})},r.createElement(T.Z,{fallback:r.createElement(O,null)},r.createElement(R,null))),r.createElement(x,{selectedValue:b,toggle:v})))}var C=(0,r.memo)(N);function O(){return r.createElement("div",null,"Loading...")}const R=(0,r.lazy)((()=>Promise.all([n.e(87876),n.e(97277),n.e(26750)]).then(n.bind(n,64511))));var P=n(60975);function _(e){let{groupId:t,defaultOpen:n,row:l,fixtures:a}=e;return r.createElement("div",{style:{overflow:"hidden",display:"flex",flexDirection:"column"}},r.createElement(P.Z,null,r.createElement(o.Z,{id:"theme.Playground.result",description:"The result label of the live codeblocks"},"Live Preview")),r.createElement("div",{className:m.Z.playgroundResult},r.createElement(C,{groupId:t,defaultOpen:n,row:l,fixtures:a})))}var I=(0,r.memo)(_)},56922:(e,t,n)=>{var r=n(67294),o=n(72887);const l={React:r,...r,...o};t.Z=l},41261:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>u});var r=n(87462),o=(n(67294),n(3905)),l=n(107);const a={title:"Rest v6",authors:["ntucker"],tags:["releases","rest-hooks","packages","rest","http","path-to-regex","resource","endpoint","typescript"]},i=void 0,s={permalink:"/blog/2022/10/23/Announcing-Rest-6",source:"@site/blog/2022-10-23-Announcing-Rest-6.md",title:"Rest v6",description:"Today we're releasing @rest-hooks/rest version 6. While this is a pretty",date:"2022-10-23T00:00:00.000Z",formattedDate:"October 23, 2022",tags:[{label:"releases",permalink:"/blog/tags/releases"},{label:"rest-hooks",permalink:"/blog/tags/rest-hooks"},{label:"packages",permalink:"/blog/tags/packages"},{label:"rest",permalink:"/blog/tags/rest"},{label:"http",permalink:"/blog/tags/http"},{label:"path-to-regex",permalink:"/blog/tags/path-to-regex"},{label:"resource",permalink:"/blog/tags/resource"},{label:"endpoint",permalink:"/blog/tags/endpoint"},{label:"typescript",permalink:"/blog/tags/typescript"}],readingTime:2.5,hasTruncateMarker:!1,authors:[{name:"Nathaniel Tucker",title:"Creator of Rest Hooks",url:"https://github.com/ntucker",imageURL:"https://github.com/ntucker.png",key:"ntucker"}],frontMatter:{title:"Rest v6",authors:["ntucker"],tags:["releases","rest-hooks","packages","rest","http","path-to-regex","resource","endpoint","typescript"]},nextItem:{title:"Adding validation helpers for required field checks",permalink:"/blog/2022/08/03/Adding-validation-helpers-for-required-fields"}},c={authorsImageUrls:[void 0]},u=[{value:"RestEndpoint",id:"restendpoint",level:2},{value:"createResource",id:"createresource",level:2},{value:"Existing design",id:"existing-design",level:2},{value:"Problems",id:"problems",level:2}],d={toc:u};function p(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Today we're releasing ",(0,o.kt)("a",{parentName:"p",href:"/rest/usage"},"@rest-hooks/rest")," version 6. While this is a pretty\nradical departure from previous versions, there is no need to upgrade if previous versions are\nworking as they will continue to work with the current 6.4 release of Rest Hooks as well as many\nfuture versions."),(0,o.kt)("h2",{id:"restendpoint"},"RestEndpoint"),(0,o.kt)(l.Z,{row:!0,mdxType:"HooksPlayground"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="api/getTodo.ts"',title:'"api/getTodo.ts"'},"const getTodo = new RestEndpoint({\n  urlPrefix: 'https://jsonplaceholder.typicode.com',\n  path: '/todos/:id',\n});\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="TodoDetail.tsx" collapsed=true',title:'"TodoDetail.tsx"',collapsed:"true"},"function TodoDetail({ id }: { id: number }) {\n  const todo = useSuspense(getTodo, { id });\n  return <div>{todo.title}</div>;\n}\nrender(<TodoDetail id={1} />);\n"))),(0,o.kt)("h2",{id:"createresource"},"createResource"),(0,o.kt)(l.Z,{row:!0,mdxType:"HooksPlayground"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="api/Todo.ts"',title:'"api/Todo.ts"'},"class Todo extends Entity {\n  id = 0;\n  userId = 0;\n  title = '';\n  completed = false;\n  pk() { return this.id }\n}\nconst TodoResource = createResource({\n  urlPrefix: 'https://jsonplaceholder.typicode.com',\n  path: '/todos/:id',\n  schema: Todo,\n});\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="TodoDetail.tsx" collapsed=true',title:'"TodoDetail.tsx"',collapsed:"true"},"function TodoDetail({ id }: { id: number }) {\n  const todo = useSuspense(TodoResource.get, { id });\n  return <div>{todo.title}</div>;\n}\nrender(<TodoDetail id={1} />);\n"))),(0,o.kt)("h1",{id:"motivation"},"Motivation"),(0,o.kt)("h2",{id:"existing-design"},"Existing design"),(0,o.kt)("p",null,"Resource ",(0,o.kt)("em",{parentName:"p"},"is")," an Entity. Endpoints are defined as static members."),(0,o.kt)("p",null,"The motivation is for brevity: This allows one import to both define the expected type as well as access the endpoints to send as hook 'subjects'."),(0,o.kt)("h2",{id:"problems"},"Problems"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Class static side is not well supported by TypeScript. This leads to the somewhat confusing but also limiting ",(0,o.kt)("a",{parentName:"li",href:"https://resthooks.io/rest/guides/rest-types"},"generic workaround"),"."),(0,o.kt)("li",{parentName:"ol"},"Inheritance does not work well for providing out-of-the-box endpoint definitions. Overrides are better",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"It's a struggle between general types that allow overrides or precise types that help developers."),(0,o.kt)("li",{parentName:"ul"},"Hacks like \u2018SchemaDetail\u2019 are an attempt around this but are confusing, expensive for typescript to compute and likely break in certain configurations."))),(0,o.kt)("li",{parentName:"ol"},"Union Resources are awkward to define as their expected schema ends up not being the Entity.",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"In general, custom schemas are often shared by multiple endpoints, making it desirable to not require them to be just an Entity"))),(0,o.kt)("li",{parentName:"ol"},"Endpoints themselves don't maintain referential equality",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"This results in hacks in our hooks that violate expectations (ignoring referential changes to endpoints). There are legit reasons one might want to create a endpoint that changes and have that trigger fetches.")))),(0,o.kt)("h1",{id:"solution-trinity-of-definitions"},"Solution: Trinity of definitions"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Schema: Data lifecycles"),(0,o.kt)("li",{parentName:"ol"},"Endpoint: Networking lifecycles"),(0,o.kt)("li",{parentName:"ol"},"Resource: Binding the two above - a collection of endpoints for a given Schema")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"class Todo extends Entity {\n  readonly id: string = '';\n  readonly content: string = '';\n\n  pk() { return this.id }\n}\nconst TodoResource = createResource({\n  path: 'http\\\\://test.com/todos/:id',\n  Todo,\n});\n\n// these are now all very specific. will error if any fields are missing  and not exactly matching\nconst todo = useSuspense(TodoResource.get, { id: '5' });\nconst todos = useSuspense(TodoResource.getList);\ncontroller.fetch(TodoResource.create, { content: 'ntucker' })\ncontroller.fetch(TodoResource.update, { id: '5' }, { content: 'ntucker' })\ncontroller.fetch(TodoResource.partialUpdate, { id: '5' }, { content: 'ntucker' })\ncontroller.fetch(TodoResource.delete, { id: '5' })\n")))}p.isMDXComponent=!0},45440:(e,t)=>{t.Z={playgroundContainer:"playgroundContainer_sLUA",row:"row_YGZs",hidden:"hidden_Hh8i",playgroundHeader:"playgroundHeader_Zx4K",small:"small_xksL",clickable:"clickable_YHiX",noupper:"noupper_WDCF",subtabs:"subtabs_XtJb",playgroundEditor:"playgroundEditor_lYwu",closed:"closed_QJMa",arrow:"arrow_tivA",vertical:"vertical_OMeC",right:"right_vs_C",left:"left_iDcB",up:"up_H4F7",down:"down_oRky",playgroundPreview:"playgroundPreview_rk9R",playgroundError:"playgroundError_sRnA",playgroundResult:"playgroundResult_tefG",debugToggle:"debugToggle_zlro",tabControls:"tabControls_trxh",title:"title_poUY",tabs:"tabs_m54V",tab:"tab_bTGw",selected:"selected_QXZk",fixtureBlock:"fixtureBlock_mpRK",fixtureItem:"fixtureItem_Jd6V",fixtureHeader:"fixtureHeader_KYel",fixtureJson:"fixtureJson_HnbR"}}}]);