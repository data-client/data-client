(self.webpackChunk=self.webpackChunk||[]).push([[59141],{484:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>m,frontMatter:()=>a,metadata:()=>c,toc:()=>d});var r=n(87462),s=(n(27378),n(3905)),i=n(28423),o=n(41191);const a={title:"Optimistic Updates"},l=void 0,c={unversionedId:"guides/optimistic-updates",id:"guides/optimistic-updates",title:"Optimistic Updates",description:"Optimistic Updates - High performance mutations",source:"@site/../docs/rest/guides/optimistic-updates.md",sourceDirName:"guides",slug:"/guides/optimistic-updates",permalink:"/rest/guides/optimistic-updates",draft:!1,editUrl:"https://github.com/data-client/rest-hooks/edit/master/docs/rest/guides/optimistic-updates.md",tags:[],version:"current",lastUpdatedBy:"Nathaniel Tucker",lastUpdatedAt:1674508225,formattedLastUpdatedAt:"Jan 23, 2023",frontMatter:{title:"Optimistic Updates"},sidebar:"docs",previous:{title:"Authentication",permalink:"/rest/guides/auth"},next:{title:"Transforming data on fetch",permalink:"/rest/guides/network-transform"}},u={},d=[{value:"Partial updates",id:"partial-updates",level:2},{value:"Optimistic create with instant updates",id:"optimistic-create-with-instant-updates",level:2},{value:"Optimistic Deletes",id:"optimistic-deletes",level:2},{value:"Optimistic Transforms",id:"optimistic-transforms",level:2},{value:"Example race condition",id:"example-race-condition",level:3},{value:"Compensating for Server timing variations",id:"server-timings",level:3}],p={toc:d};function m(e){let{components:t,...n}=e;return(0,s.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("head",null,(0,s.kt)("title",null,"Optimistic Updates - High performance mutations"),(0,s.kt)("meta",{name:"docsearch:pagerank",content:"40"})),(0,s.kt)("p",null,"Optimistic updates enable highly responsive and fast interfaces by avoiding network wait times.\nAn update is optimistic by assuming the network is successful. In the case of any errors, Rest\nHooks will then roll back any changes in a way that deals with all possible race conditions."),(0,s.kt)("h2",{id:"partial-updates"},"Partial updates"),(0,s.kt)("p",null,"One common use case is for quick toggles. Here we demonstrate a publish button for an\narticle. Note that we need to include the primary key (",(0,s.kt)("inlineCode",{parentName:"p"},"id")," in this case) in the response\nbody to ensure the normalized cache gets updated correctly."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="api/Article.ts"',title:'"api/Article.ts"'},"import { Entity, createResource } from '@rest-hooks/rest';\n\nexport class Article extends Entity {\n  readonly id: string | undefined = undefined;\n  readonly title: string = '';\n  readonly content: string = '';\n  readonly published: boolean = false;\n\n  pk() {\n    return this.id;\n  }\n}\n\nconst BaseArticleResource = createResource({\n  path: '/articles/:id',\n  schema: Article,\n});\nexport const ArticleResource = {\n  ...BaseArticleResource,\n  partialUpdate: BaseArticleResource.partialUpdate.extend({\n    // highlight-start\n    getOptimisticResponse(snap, { id }, body) {\n      return {\n        // we absolutely need the id for primary key here,\n        // but won't be a member of body\n        id,\n        ...body,\n      };\n    },\n    // highlight-end\n  }),\n};\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="PublishButton.tsx"',title:'"PublishButton.tsx"'},"import { useController } from '@rest-hooks/react';\nimport { ArticleResource } from 'api/Article';\n\nexport default function PublishButton({ id }: { id: string }) {\n  const controller = useController();\n\n  return (\n    <button\n      onClick={() =>\n        controller.fetch(\n          ArticleResource.partialUpdate,\n          { id },\n          { published: true },\n        )\n      }\n    >\n      Publish\n    </button>\n  );\n}\n")),(0,s.kt)("h2",{id:"optimistic-create-with-instant-updates"},"Optimistic create with instant updates"),(0,s.kt)("p",null,"Optimistic updates can also be combined with ",(0,s.kt)("a",{parentName:"p",href:"/docs/concepts/atomic-mutations"},"atomic mutations"),", enabling updates to\nother endpoints instantly. This is most commonly seen when creating new items\nwhile viewing a list of them."),(0,s.kt)("p",null,"Here we demonstrate what could be used in a list of articles with a modal\nto create a new article. On submission of the form it would instantly\nadd to the list of articles the newly created article - without waiting on a network response."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="api/Article.ts"',title:'"api/Article.ts"'},"import { Entity, createResource } from '@rest-hooks/rest';\nimport uuid from 'uuid/v4';\n\nexport class Article extends Entity {\n  id: string | undefined = undefined;\n  title = '';\n  content = '';\n  published = false;\n\n  pk() {\n    return this.id;\n  }\n}\n\nconst BaseArticleResource = createResource({\n  path: '/articles/:id',\n  schema: Article,\n});\nexport const ArticleResource = {\n  ...BaseArticleResource,\n  create: BaseArticleResource.create.extend({\n    getRequestInit(body) {\n      if (body) {\n        return this.constructor.prototype.getRequestInit.call(this, {\n          // highlight-next-line\n          id: uuid(),\n          ...body,\n        });\n      }\n      return this.constructor.prototype.getRequestInit.call(this, body);\n    },\n    getOptimisticResponse(snap, params, body) {\n      return body;\n    },\n    update(newResourcePk: string) {\n      return {\n        [list.key({})]: (resourcePks: string[] = []) => [\n          ...resourcePks,\n          newResourcePk,\n        ],\n      };\n    },\n  }),\n};\n")),(0,s.kt)("p",null,"Since the actual ",(0,s.kt)("inlineCode",{parentName:"p"},"id")," of the article is created on the server, we will need to fill\nin a temporary fake ",(0,s.kt)("inlineCode",{parentName:"p"},"id")," here, so the ",(0,s.kt)("inlineCode",{parentName:"p"},"primary key")," can be generated. This is needed\nto properly normalize the article to be looked up in the cache."),(0,s.kt)("p",null,"Once the network responds, it will have a different ",(0,s.kt)("inlineCode",{parentName:"p"},"id"),", which will replace the existing\ndata. This is often seamless, but care should be taken if the fake ",(0,s.kt)("inlineCode",{parentName:"p"},"id")," is used in any\nrenders - like to issue subsequent requests. We recommend disabling ",(0,s.kt)("inlineCode",{parentName:"p"},"edit")," type features\nthat rely on the ",(0,s.kt)("inlineCode",{parentName:"p"},"primary key")," until the network fetch completes."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="CreateArticle.tsx"',title:'"CreateArticle.tsx"'},"import { useController } from '@rest-hooks/react';\nimport { ArticleResource } from 'api/Article';\n\nexport default function CreateArticle() {\n  const ctrl = useController();\n  const submitHandler = useCallback(\n    data => ctrl.fetch(ArticleResource.create, data),\n    [create],\n  );\n\n  return <Form onSubmit={submitHandler}>{/* rest of form */}</Form>;\n}\n")),(0,s.kt)("h2",{id:"optimistic-deletes"},"Optimistic Deletes"),(0,s.kt)("p",null,"Since deletes ",(0,s.kt)("a",{parentName:"p",href:"/docs/concepts/atomic-mutations#delete"},"automatically update the cache correctly")," upon fetch success,\nmaking your delete endpoint do this optimistically is as easy as adding the ",(0,s.kt)("a",{parentName:"p",href:"/rest/api/RestEndpoint#getoptimisticresponse"},"getOptimisticResponse"),"\nfunction to your options."),(0,s.kt)("p",null,"We return an empty string because that's the response we expect from the server. Although by\ndefault, the server response is ignored."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="api/Article.ts"',title:'"api/Article.ts"'},"import { Entity, createResource } from '@rest-hooks/rest';\n\nexport class Article extends Entity {\n  readonly id: string | undefined = undefined;\n  readonly title: string = '';\n  readonly content: string = '';\n  readonly published: boolean = false;\n\n  pk() {\n    return this.id;\n  }\n}\n\nconst BaseArticleResource = createResource({\n  path: '/articles/:id',\n  schema: Article,\n});\nexport const ArticleResource = {\n  ...BaseArticleResource,\n  delete: BaseArticleResource.delete.extend({\n    // highlight-start\n    getOptimisticResponse(snap, params, body) {\n      return params;\n    },\n    // highlight-end\n  }),\n};\n")),(0,s.kt)("h2",{id:"optimistic-transforms"},"Optimistic Transforms"),(0,s.kt)("p",null,"Sometimes user actions should result in data transformations that are dependent on the previous state of data.\nThe simplest examples of this are toggling a boolean, or incrementing a counter; but the same principal applies to\nmore complicated transforms. To make it more obvious we're using a simple counter here."),(0,s.kt)(i.Z,{fixtures:[{endpoint:new o.Z({path:"/api/count"}),args:[],response:{count:0}},{endpoint:new o.Z({path:"/api/count/increment",method:"POST",body:void 0}),response:()=>({count:globalThis.RH_count=(globalThis.RH_count??0)+1}),delay:()=>500+4500*Math.random()}],mdxType:"HooksPlayground"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="api/Count.ts" {19-25}',title:'"api/Count.ts"',"{19-25}":!0},"export class CountEntity extends Entity {\n  count = 0;\n\n  pk() {\n    return `SINGLETON`;\n  }\n}\nexport const getCount = new RestEndpoint({\n  path: '/api/count',\n  schema: CountEntity,\n  name: 'get',\n});\nexport const increment = new RestEndpoint({\n  path: '/api/count/increment',\n  method: 'POST',\n  body: undefined,\n  name: 'increment',\n  schema: CountEntity,\n  getOptimisticResponse(snap) {\n    const { data } = snap.getResponse(getCount);\n    if (!data) throw new AbortOptimistic();\n    return {\n      count: data.count + 1,\n    };\n  },\n});\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="CounterPage.tsx" collapsed',title:'"CounterPage.tsx"',collapsed:!0},"import { useLoading } from '@rest-hooks/hooks';\nimport { getCount, increment } from './api/Count';\n\nfunction CounterPage() {\n  const ctrl = useController();\n  const { count } = useSuspense(getCount);\n  const [stateCount, setStateCount] = React.useState(0);\n  const [responseCount, setResponseCount] = React.useState(0);\n  const [clickHandler, loading, error] = useLoading(async () => {\n    setStateCount(stateCount+1);\n    const val = await ctrl.fetch(increment);\n    setResponseCount(val.count);\n    setStateCount(val.count);\n  });\n  return (\n    <div>\n      <p>\n        Click the button multiple times quickly to trigger the race condition\n      </p>\n      <div>\n        Rest Hooks: {count}\n        <br />\n        Other Libraries: {responseCount}; with optimistic: {stateCount}\n        <br />\n        <button onClick={clickHandler}>+</button>\n        {loading ? ' ...loading' : ''}\n      </div>\n    </div>\n  );\n}\nrender(<CounterPage />);\n"))),(0,s.kt)("p",null,"Rest Hooks automatically handles all race conditions due to network timings. Rest Hooks both tracks\nfetch timings, pairs responses with their respective optimistic update and rollsback in case of resolution or\nrejection/failure."),(0,s.kt)("p",null,"You can see how this is problematic for other libraries even without optimistic updates;\nbut optimistic updates make it even worse."),(0,s.kt)("h3",{id:"example-race-condition"},"Example race condition"),(0,s.kt)("p",null,"Here's an example of the race condition. Here we request an increment twice; but the first response comes back to\nclient after the second response."),(0,s.kt)("mermaid",{value:"sequenceDiagram\n    autonumber\n    participant Client\n    participant Server\n    Client->>+Server: Increment from 0\n    Client->>+Server: Increment from 1\n    Server->>-Client: Response: 2\n    Server->>-Client: Response: 1"}),(0,s.kt)("p",null,"With other libraries and no optimistic updates this would result in showing 0, then, 2, then 1."),(0,s.kt)("p",null,"If the other library does have optimistic updates, it should show 0, 1, 2, 2, then 1."),(0,s.kt)("p",null,"In both cases we end up showing an incorrect state, and along the way see weird janky state updates."),(0,s.kt)("h3",{id:"server-timings"},"Compensating for Server timing variations"),(0,s.kt)("mermaid",{value:"sequenceDiagram\n    autonumber\n    participant Client\n    participant Server\n    Client->>Server: Request timing\n    Note over Client,Server: Server timing\n    Server->>Client: Response timing"}),(0,s.kt)("p",null,"There are three timings which can vary in an async mutation."),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"Request timing"),(0,s.kt)("li",{parentName:"ol"},"Server timing"),(0,s.kt)("li",{parentName:"ol"},"Response timing")),(0,s.kt)("p",null,"Rest Hooks is able to automatically handling the network timings, aka request and response timing. Typically this\nis sufficient, as servers tend to process requests received first before others. However, in case persist order\nvaries from request order in the server this could cause another race condition."),(0,s.kt)("p",null,"This can be be solved by maintaining a ",(0,s.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Total_order"},"total order"),". Because the\nservers and clients can potentially has different times, we will need to track time from a consistent perspective.\nSince we are performing optimistic updates this means we must use the client's clock. This means we will send the request\ntiming to the server in an ",(0,s.kt)("inlineCode",{parentName:"p"},"updatedAt")," header via ",(0,s.kt)("a",{parentName:"p",href:"/rest/api/RestEndpoint#getRequestInit"},"getRequestInit()"),". The server should then ensure processing based on that order, and\nthen store this ",(0,s.kt)("inlineCode",{parentName:"p"},"updatedAt")," in the entity to return in any request."),(0,s.kt)("p",null,"Overriding our ",(0,s.kt)("a",{parentName:"p",href:"/rest/api/Entity#useincoming"},"useIncoming"),", we can check which data is newer, and disregard old data\nthat resolves out of order."),(0,s.kt)("p",null,"We use ",(0,s.kt)("a",{parentName:"p",href:"/docs/api/Snapshot#fetchedat"},"snap.fetchedAt")," in our ",(0,s.kt)("a",{parentName:"p",href:"/rest/api/RestEndpoint#getoptimisticresponse"},"getOptimisticResponse"),". This respresents the moment the fetch is triggered, which will be the same time the ",(0,s.kt)("inlineCode",{parentName:"p"},"updatedAt")," header is computed."),(0,s.kt)(i.Z,{fixtures:[{endpoint:new o.Z({path:"/api/count"}),args:[],response:{count:0,updatedAt:Date.now()}}],mdxType:"HooksPlayground"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="api/Count.ts" {24-29,35}',title:'"api/Count.ts"',"{24-29,35}":!0},"export class CountEntity extends Entity {\n  count = 0;\n  updatedAt = 0;\n\n  pk() {\n    return `SINGLETON`;\n  }\n\n  static useIncoming(existingMeta, incomingMeta, existing, incoming) {\n    return existing.updatedAt <= incoming.updatedAt;\n  }\n}\nexport const getCount = new RestEndpoint({\n  path: '/api/count',\n  schema: CountEntity,\n  name: 'get',\n});\nexport const increment = new RestEndpoint({\n  path: '/api/count/increment',\n  method: 'POST',\n  body: undefined,\n  name: 'increment',\n  schema: CountEntity,\n  getRequestInit() {\n    // this is a substitute for super.getRequestInit() since we aren't in a class context\n    return this.constructor.prototype.getRequestInit.call(this, {\n      updatedAt: Date.now(),\n    });\n  },\n  getOptimisticResponse(snap) {\n    const { data } = snap.getResponse(getCount);\n    if (!data) throw new AbortOptimistic();\n    return {\n      count: data.count + 1,\n      updatedAt: snap.fetchedAt,\n    };\n  },\n});\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="CounterPage.tsx" collapsed',title:'"CounterPage.tsx"',collapsed:!0},"import { useLoading } from '@rest-hooks/hooks';\nimport { getCount, increment } from './api/Count';\n\nfunction CounterPage() {\n  const ctrl = useController();\n  const { count } = useSuspense(getCount);\n  const [n, setN] = React.useState(count);\n  const [clickHandler, loading, error] = useLoading(() => {\n    setN(n => n + 1);\n    return ctrl.fetch(increment);\n  });\n  return (\n    <div>\n      <p>\n        Click the button multiple times quickly to trigger the potential race\n        condition. This time our vector clock protects us.\n      </p>\n      <div>\n        Network: {count} Should be: {n}\n        <br />\n        <button onClick={clickHandler}>+</button>\n        {loading ? ' ...loading' : ''}\n      </div>\n    </div>\n  );\n}\nrender(<CounterPage />);\n"))))}m.isMDXComponent=!0},69762:(e,t,n)=>{"use strict";const r=(0,n(67294).createContext)({selectedValue:"",setSelectedValue:e=>{throw new Error("No Tab provider")},values:[]});t.Z=r},28423:(e,t,n)=>{"use strict";n.d(t,{Z:()=>x});var r=n(67294),s=n(87462),i=n(99401),o=n(6832),a=n(86010),l=n(49544),c=n(45045);function u(){return r.createElement(r.Fragment,null,r.createElement("script",{dangerouslySetInnerHTML:{__html:p},type:"application/javascript"}))}var d=(0,r.memo)(u);const p=`\nif (!/bot|googlebot|crawler|spider|robot|crawling|Mobile|Android|BlackBerry/i.test(\n  navigator.userAgent,\n) && !window.monacoPreloaded) {\n[${["https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs/editor/editor.main.js","https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs/editor/editor.main.nls.js","https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs/basic-languages/typescript/typescript.js","https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs/language/typescript/tsMode.js"].map((e=>`'${e}'`)).join(",")}].forEach(href => {\nwindow.monacoPreloaded = true;\nvar link = document.createElement("link");\nlink.href = href;\nlink.rel = "preload";\nlink.as = href.endsWith('.js') ? 'script' : 'style';\ndocument.head.appendChild(link);\n});\n[${["https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs/base/worker/workerMain.js","https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs/language/typescript/tsWorker.js"].map((e=>`'${e}'`)).join(",")}].forEach(href => {\nwindow.monacoPreloaded = true;\nvar link = document.createElement("link");\nlink.href = href;\nlink.rel = "prefetch";\nlink.as = 'script';\ndocument.head.appendChild(link);\n});\n}\n`;var m=n(24338),h=n(80086),g=n(45440);function f(e){let{children:t,transformCode:n,groupId:c,defaultOpen:u,row:p,hidden:m,fixtures:h,includeEndpoints:f,...b}=e;const{liveCodeBlock:{playgroundPosition:k}}=(0,o.Z)().siteConfig.themeConfig,v=(0,i.p)();return r.createElement(r.Fragment,null,r.createElement("div",{className:(0,a.Z)(g.Z.playgroundContainer,{[g.Z.row]:p,[g.Z.hidden]:m})},r.createElement(l.nu,(0,s.Z)({theme:v},b),r.createElement(y,{reverse:"top"===k,row:p,fixtures:h,includeEndpoints:f,groupId:c,defaultOpen:u},t))),r.createElement(d,null))}function y(e){let{reverse:t,children:n,row:s,fixtures:i,includeEndpoints:o,groupId:a,defaultOpen:u}=e;const{handleCodeChange:d,codes:p,codeTabs:g}=(0,m.h)(n),f=p.join("\n");return r.createElement(v,{reverse:t},r.createElement(m.L,{fixtures:i,row:s,codeTabs:g,handleCodeChange:d,codes:p}),r.createElement(c.Z,{fallback:r.createElement(l.nu,{key:"preview",code:'render(() => "Loading...");',noInline:!0},r.createElement(h.Z,{key:"preview",includeEndpoints:o,groupId:a,defaultOpen:u,row:s,fixtures:i}))},r.createElement(k,{code:f,includeEndpoints:o,groupId:a,defaultOpen:u,row:s,fixtures:i})))}f.defaultProps={row:!1,hidden:!1};const b="object"==typeof navigator&&/bot|googlebot|crawler|spider|robot|crawling/i.test(navigator?.userAgent),k=(0,r.lazy)((()=>b?Promise.resolve({default:e=>null}):Promise.all([n.e(86429),n.e(87876),n.e(92765),n.e(26750)]).then(n.bind(n,41380))));function v(e){let{children:t,reverse:n}=e;const r=[...t];return r.reverse(),n?r:t}v.defaultProps={reverse:!1};const w=e=>{let{children:t,groupId:n,hidden:s=!1,defaultOpen:i,row:o=!1,fixtures:a}=e;return r.createElement(f,{includeEndpoints:!Array.isArray(t),noInline:!0,groupId:n,defaultOpen:i,row:o,hidden:s,fixtures:a},"string"==typeof t||Array.isArray(t)?t:t.props.children)};w.defaultProps={defaultOpen:"n",fixtures:[]};var x=(0,r.memo)(w)},45045:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(19666),s=n(67294);function i(e){let{fallback:t,children:n}=e;return s.createElement(r.Z,{fallback:t},(()=>s.createElement(s.Suspense,{fallback:t},n)))}},62974:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(67294),s=n(86010),i=n(45440);function o(e){let{children:t,className:n,onClick:o}=e;return r.createElement("div",{className:(0,s.Z)(i.Z.playgroundHeader,n,o?i.Z.clickable:null),onClick:o},t)}},24338:(e,t,n)=>{"use strict";n.d(t,{L:()=>R,h:()=>S});var r=n(87462),s=n(11614),i=n(86010),o=n(67294),a=n(13743),l=n(45440);function c(e){let{fixtures:t}=e;return o.createElement("div",{className:l.Z.fixtureBlock},t.map(((e,t)=>o.createElement(p,{key:t,fixture:e}))))}var u=(0,o.memo)(c);function d(e){let{fixture:t}=e;return"function"==typeof t.response?o.createElement(a.Z,{language:"javascript",className:l.Z.fixtureJson},`${t.response}`):o.createElement(a.Z,{language:"json",className:l.Z.fixtureJson},JSON.stringify(t.response))}function p(e){let{fixture:t}=e;return"args"in t?o.createElement("div",{key:t.endpoint.key(...t.args),className:l.Z.fixtureItem},o.createElement("div",{className:l.Z.fixtureHeader},t.endpoint.key(...t.args)),o.createElement(d,{fixture:t})):o.createElement("div",{className:l.Z.fixtureItem},o.createElement("div",{className:l.Z.fixtureHeader},t.endpoint.method," ",t.endpoint.path),o.createElement(d,{fixture:t}))}var m=n(62974),h=n(49544);const g=(0,o.memo)(h.uz);var f=n(76226),y=n(87594),b=n.n(y),k=n(30573);let v;if("undefined"!=typeof window&&!/bot|googlebot|crawler|spider|robot|crawling/i.test(navigator.userAgent)){const e=["rest","core","react","endpoint","normalizr","graphql","hooks"],t=["react","rest-hooks","@rest-hooks/rest","@rest-hooks/react","@rest-hooks/graphql","@rest-hooks/hooks","bignumber.js"];if(!v){const r=k.Z.init();r.then((e=>{e&&(v=e,e.languages.typescript.typescriptDefaults.setCompilerOptions({allowNonTsExtensions:!0,target:e.languages.typescript.ScriptTarget.ES2017,jsx:e.languages.typescript.JsxEmit.React,strict:!0,strictNullChecks:!0,exactOptionalPropertyTypes:!0,lib:["dom","esnext"],module:e.languages.typescript.ModuleKind.ESNext,moduleResolution:e.languages.typescript.ModuleResolutionKind.NodeJs,typeRoots:["node_modules/@types"],allowSyntheticDefaultImports:!0,skipLibCheck:!0,noImplicitAny:!1}),e.editor.defineTheme("prism",{base:"vs-dark",inherit:!0,rules:[{token:"number",foreground:"f78c6c"},{token:"string",foreground:"b6d986"},{token:"keyword",fontStyle:"italic",foreground:"7da4f6"},{token:"type",foreground:"ffcb6b"},{token:"delimiter",foreground:"C792EA"},{token:"tag",foreground:"FF5590"}],colors:{"editor.foreground":"#bfc7d5","editor.inactiveSelectionBackground":"#484d5b"}}),e.languages.registerCompletionItemProvider("typescript",{triggerCharacters:["'",'"',".","/"],provideCompletionItems:(n,r)=>{const s=n.getValueInRange({startLineNumber:1,startColumn:1,endLineNumber:r.lineNumber,endColumn:r.column});if(/(([\s|\n]+from\s+)|(\brequire\b\s*\())["|'][^'^"]*$/.test(s)){if(s.endsWith(".")||s.endsWith("/")){const t=e.editor.getModels().map((e=>e.uri.path)).map((t=>{const n=/\/\d+\//g.exec(t)?.[0]??"",r=t.substring(n.length-1);return{label:r,insertText:r.replace(/\.tsx?$/,""),kind:e.languages.CompletionItemKind.Module}}));if(!t.length)return;return{suggestions:t}}return{suggestions:t.map((t=>({label:t,kind:e.languages.CompletionItemKind.Module,insertText:t})))}}}}))})),Promise.allSettled([r,n.e(37956).then(n.t.bind(n,70637,23)),n.e(49033).then(n.t.bind(n,7712,23)),n.e(42713).then(n.t.bind(n,93716,23)),n.e(78789).then(n.t.bind(n,52031,23)),...e.map((e=>n(73795)(`./${e}.d.ts`)))]).then((t=>{let[n,...r]=t;if("fulfilled"!==n.status||!n.value)return;const s=n.value,[i,o,a,l,...c]=r.map((e=>"fulfilled"===e.status?e.value.default:""));return s.languages.typescript.typescriptDefaults.addExtraLib("declare module \"react/jsx-runtime\" {\n        import './';\n      }","file:///node_modules/@types/react/jsx-runtime.d.ts"),s.languages.typescript.typescriptDefaults.addExtraLib("import * as React from 'react'\n\n    declare global {\n      namespace JSX {\n        interface IntrinsicElements {\n          strike: React.DetailedHTMLProps<React.HTMLAttributes<HTMLElement>, HTMLElement>;\n        }\n      }\n    }","file:///node_modules/@types/react/more.d.ts"),s.languages.typescript.typescriptDefaults.addExtraLib("declare function render(component:JSX.Element):void;\n        declare function CurrentTime(props: {}):JSX.Element;\n        declare function ResetableErrorBoundary(props: { children: JSX.ReactChild }):JSX.Element;\n        declare function randomFloatInRange(min: number, max: number, decimals?: number): number;"),s.languages.typescript.typescriptDefaults.addExtraLib(i,"es2022"),s.languages.typescript.typescriptDefaults.addExtraLib(`declare module "react" { ${o} }`,"file:///node_modules/@types/react/index.d.ts"),s.languages.typescript.typescriptDefaults.addExtraLib(`declare module "bignumber.js" { ${a} }`,"file:///node_modules/bignumber.js/index.d.ts"),s.languages.typescript.typescriptDefaults.addExtraLib(`declare module "rest-hooks" { ${l} }`,"file:///node_modules/rest-hooks/index.d.ts"),s.languages.typescript.typescriptDefaults.addExtraLib(`declare globals { ${o} }`),c.forEach(((t,n)=>{const r=e[n];s.languages.typescript.typescriptDefaults.addExtraLib(`declare module "@rest-hooks/${r}" { ${t} }`,`file:///node_modules/@rest-hooks/${t}/index.d.ts`),["rest","react"].includes(r)&&s.languages.typescript.typescriptDefaults.addExtraLib(`declare globals { ${t} }`)})),s.languages.typescript.typescriptDefaults.setEagerModelSync(!0),s}))}}const w=(0,o.memo)(f.ZP);const x={scrollbar:{alwaysConsumeMouseWheel:!1},minimap:{enabled:!1},wordWrap:"on",scrollBeyondLastLine:!1,wrappingIndent:"indent",lineNumbers:"off",folding:!1,fontLigatures:!0,fontFamily:'"Roboto Mono",SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace',fontSize:13,lineHeight:19},E={...x,fontSize:14,lineHeight:20};var C=n(3495).Z?function(e){let{onChange:t,code:n,path:r,autoFocus:s=!1,large:i=!1,...a}=e;const l=i?E:x;r.endsWith(".tsx")||r.endsWith(".ts")||(r+=".tsx");const[c,u]=(0,o.useState)("100%"),d=(0,o.useCallback)((e=>{s&&e.focus();const t=Object.keys(a).map((e=>/\{([\d\-,.]+)\}/.exec(e)?.[1])).filter(Boolean).map(b());if(t.length){let n=t[0][0],r=n;const s=[];t[0].forEach((e=>{e===r?r++:(s.push({selectionStartLineNumber:n,selectionStartColumn:0,positionLineNumber:r,positionColumn:0}),n=e,r=e+1)})),s.push({selectionStartLineNumber:n,selectionStartColumn:0,positionLineNumber:r,positionColumn:0}),e.setSelections(s)}const n=l.lineHeight,r=e.getDomNode(),i=r.getElementsByClassName("view-lines")[0];let o=0;const c=e.getModel().getLineCount()*n+10;return r.style.height=c+"px",u(c),e.layout(),e.onDidChangeModelDecorations((()=>{setTimeout((()=>{const t=(e.getModel()?.getLineCount?.()??i.childElementCount)*n+10;o=i.childElementCount,r.style.height=t+"px",u(t),e.layout()}),0)})),()=>e?.dispose()}),[]);return o.createElement(w,{path:r,defaultLanguage:"typescript",onChange:t,defaultValue:n,options:l,theme:"prism",onMount:d,height:c,loading:o.createElement(h.uz,{language:"tsx",code:n,disabled:!0})})}:function(e){let{onChange:t,code:n}=e;return o.createElement(g,{onChange:t,code:n})},N=n(69762);function R(e){let{fixtures:t,row:n,codeTabs:s,handleCodeChange:a,codes:c,large:u=!1,isPlayground:d=!0}=e;const p=(0,o.useMemo)((()=>(1e4*Math.random()).toPrecision(4).toString()),[]),[m,h]=(0,o.useState)((()=>s.map((e=>{let{collapsed:t}=e;return t}))));return o.createElement("div",null,o.createElement(_,{fixtures:n?[]:t,title:n&&1===s.length?s[0].title:void 0}),n&&s.length>1?o.createElement(O,{titles:s.map((e=>{let{title:t}=e;return t})),closedList:m,onClick:e=>h((t=>t.map(((t,n)=>n!==e)))),isPlayground:d}):null,s.map(((e,d)=>{let{title:g,path:f,code:y,collapsed:b,...k}=e;return o.createElement(o.Fragment,{key:d},!n&&g?o.createElement(A,{onClick:()=>h((e=>{const t=[...e];return t[d]=!t[d],t})),closed:m[d],title:g,collapsible:s.length>1||t?.length,lastChild:d===s.length-1&&u}):null,o.createElement("div",{key:d,className:(0,i.Z)(l.Z.playgroundEditor,{[l.Z.hidden]:m[d]})},o.createElement(C,(0,r.Z)({key:d,onChange:a[d],code:c[d],path:"/"+p+"/"+(f||g||"default.tsx")},k,{large:u}))))})))}function S(e){const t=(0,o.useMemo)((()=>"string"==typeof e?[{code:e.replace(/\n$/,""),collapsed:!1}]:(Array.isArray(e)?e:[e]).filter((e=>e.props.children)).map((e=>"string"==typeof e.props.children?e.props:e.props.children.props)).map((e=>{let{children:t,title:n="",collapsed:r=!1,path:s,...i}=e;return{code:t.replace(/\n$/,""),title:n.replaceAll('"',""),collapsed:r,path:s,...i}}))),[e]),[n,r]=(0,o.useReducer)(Z,void 0,(()=>t.map((e=>{let{code:t}=e;return t}))));return{handleCodeChange:(0,o.useMemo)((()=>t.map(((e,t)=>e=>{r({i:t,code:e})}))),[t.length]),codes:n,codeTabs:t}}function Z(e,t){const n=[...e];return n[t.i]=t.code,n}function A(e){let{onClick:t,closed:n,title:r,collapsible:s=!1,lastChild:a=!1}=e;return s?o.createElement(m.Z,{className:(0,i.Z)(l.Z.small,{[l.Z.lastChild]:a&&n}),onClick:t},o.createElement("span",{className:(0,i.Z)(l.Z.arrow,n?l.Z.right:l.Z.down)},"\u25b6"),r):o.createElement("div",{className:l.Z.codeHeader},r)}function O(e){let{titles:t,closedList:n,onClick:r,isPlayground:s=!0}=e;const{values:a}=(0,o.useContext)(N.Z),c=a.length>0;return o.createElement(m.Z,{className:(0,i.Z)({[l.Z.small]:c||!s,[l.Z.subtabs]:c},l.Z.noupper,l.Z.tabControls)},o.createElement("div",{className:l.Z.tabs,role:"tablist","aria-orientation":"horizontal"},t.map(((e,t)=>o.createElement("div",{role:"tab",key:t,onClick:()=>r(t),className:(0,i.Z)(l.Z.tab,{[l.Z.selected]:!n[t]})},e)))))}function P(){const{selectedValue:e,setSelectedValue:t,values:n}=(0,o.useContext)(N.Z);return o.createElement("div",{className:l.Z.tabs,role:"tablist","aria-orientation":"horizontal"},n.map((n=>{let{value:r,label:s}=n;return o.createElement("div",{role:"tab",tabIndex:e===r?0:-1,"aria-selected":e===r,key:r,className:(0,i.Z)(l.Z.tab,{[l.Z.selected]:e===r}),onFocus:t,onClick:t,value:r},s)})))}function T(e){let{children:t}=e;return o.createElement(m.Z,{className:l.Z.tabControls},o.createElement("div",{className:l.Z.title},t),o.createElement(P,null))}function _(e){let{title:t,fixtures:n=[]}=e;const{values:r}=(0,o.useContext)(N.Z),s=r.length>0;return o.createElement(o.Fragment,null,n.length?o.createElement(o.Fragment,null,o.createElement(m.Z,{className:l.Z.small},"Fixtures"),o.createElement(u,{fixtures:n})):null,s?o.createElement(T,null,t):null)}_.defaultProps={title:o.createElement(s.Z,{id:"theme.Playground.liveEditor",description:"The live editor label of the live codeblocks"},"Editor"),fixtures:[]}},80086:(e,t,n)=>{"use strict";n.d(t,{Z:()=>T});var r=n(11614),s=n(67294),i=n(62974),o=n(63735),a=n(78871),l=n(86010),c=n(92785),u=n(92954),d=n(48256),p=n(3604),m=n(45045),h=n(29451),g=n(70524),f=n(287);function y(e){let{value:t}=e;const n="dark"===(0,g.I)().colorMode,r=(0,s.useMemo)((()=>({String:"rgb(195, 232, 141)",Date:"rgb(247, 140, 108)",Number:"rgb(247, 140, 108)",Boolean:"rgb(247, 140, 108)",Null:"rgb(255, 88, 116)",Undefined:"rgb(255, 88, 116)",Function:"rgb(247, 140, 108)",Symbol:"rgb(247, 140, 108)"})),[]),i=(0,s.useMemo)((()=>({tree:{overflow:"auto",flex:"4 1 70%",margin:0,padding:"0 0.5rem 0 0.8rem",backgroundColor:n?"var(--ifm-pre-background)":"rgb(41, 45, 62)",font:"var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace) !important",color:"rgb(227, 227, 227)"},arrowContainer:(e,t)=>{let{style:n}=e;return{style:{...n,fontFamily:"arial",padding:"7px 7px 7px 0",margin:"-7px calc(0.5em - 7px) -7px 0"}}},arrowSign:{color:"rgb(130, 170, 255)"},label:{color:"rgb(130, 170, 255)"},itemRange:{color:"rgb(105, 112, 152)"},valueText:(e,t)=>{let{style:n}=e;return{style:{...n,color:r[t]}}},base0B:"rgb(191, 199, 213)"})),[n,r]),o=(0,s.useMemo)(b,[]);return s.createElement(f.L,{shouldExpandNodeInitially:o,data:t,valueRenderer:v,theme:i,hideRoot:!0})}const b=()=>{let e=0;return(t,n,r)=>0===r||(!(1!==r||!["entities","results"].includes(t[0]))||(2===r&&"entities"===t[1]||(2===r&&"results"===t[1]||(3===r&&"entities"===t[2]?e++<4:3===r&&"results"===t[2]))))},k="undefined"!=typeof Intl;function v(e,t){const n=arguments.length<=2?void 0:arguments[2];return k&&"number"==typeof t&&"string"==typeof n&&isFinite(t)&&("date"===n||n.endsWith("At"))?Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:3}).format(t):e}var w=n(45440);function x(e){let{toggle:t,selectedValue:n}=e;const r="y"===n,i=r?w.Z.right:w.Z.left;return s.createElement(s.Fragment,null,s.createElement("div",{className:w.Z.debugToggle,onClick:t},"Store",s.createElement("span",{className:(0,l.Z)(w.Z.arrow,i,w.Z.vertical)},"\u25b6")),r?s.createElement(N,null):null)}var E=(0,s.memo)(x);function C(){const e=(0,s.useContext)(h.sA),t=(0,s.useMemo)((()=>{const t={...e};return delete t.optimistic,t}),[e]);return s.createElement(y,{value:t})}const N=(0,s.memo)(C);var R=n(32295);function S(e){let{groupId:t,defaultOpen:n,row:r,fixtures:i}=e;const[h,g]=(0,R.X)(`docusaurus.tab.${t}`),[f,y]=(0,s.useState)(n),{blockElementScrollPositionUntilNextRender:b}=(0,o.o5)();null!=h&&h!==f&&y(h);const k=(0,s.useCallback)((e=>{b(e.currentTarget),y((e=>"y"===e?"n":"y")),g("y"===f?"n":"y")}),[b,f,g]),v=(0,s.useMemo)((()=>[new c.Z,new u.Z(d.Z)]),[]),x=!("n"===f||!r);return s.createElement(p.Z,{managers:v},s.createElement(a.Z,{fixtures:i,silenceMissing:!0},s.createElement("div",{className:(0,l.Z)(w.Z.playgroundPreview,{[w.Z.hidden]:x})},s.createElement(m.Z,{fallback:s.createElement(A,null)},s.createElement(O,null))),s.createElement(E,{selectedValue:f,toggle:k})))}var Z=(0,s.memo)(S);function A(){return s.createElement("div",null,"Loading...")}const O=(0,s.lazy)((()=>Promise.all([n.e(86429),n.e(87876),n.e(92765),n.e(26750)]).then(n.bind(n,15929))));function P(e){let{groupId:t,defaultOpen:n,row:o,fixtures:a}=e;return s.createElement("div",{style:{overflow:"hidden",display:"flex",flexDirection:"column"}},s.createElement(i.Z,null,s.createElement(r.Z,{id:"theme.Playground.result",description:"The result label of the live codeblocks"},"Live Preview")),s.createElement("div",{className:w.Z.playgroundResult},s.createElement(Z,{groupId:t,defaultOpen:n,row:o,fixtures:a})))}var T=(0,s.memo)(P)},3495:(e,t)=>{"use strict";const n="undefined"!=typeof window&&!/bot|googlebot|crawler|spider|robot|crawling|Mobile|Android|BlackBerry/i.test(navigator.userAgent);t.Z=n},57489:(e,t,n)=>{"use strict";var r=n(67294),s=n(64820);const i={React:r,...r,...s};t.Z=i},32295:(e,t,n)=>{"use strict";n.d(t,{X:()=>i});var r=n(99200),s=n(67294);function i(e){const t=o(e),[n,i]=(0,r.Nk)(t);return[n,(0,s.useCallback)((e=>{t&&i.set(e)}),[t,i])]}const o=e=>`docusaurus.tab.${e}`},45440:(e,t)=>{"use strict";t.Z={playgroundContainer:"playgroundContainer_sLUA",standaloneEditor:"standaloneEditor_OHub",row:"row_YGZs",playgroundHeader:"playgroundHeader_Zx4K",tabControls:"tabControls_trxh",hidden:"hidden_Hh8i",small:"small_xksL",clickable:"clickable_YHiX",noupper:"noupper_WDCF",lastChild:"lastChild_htAV",codeHeader:"codeHeader_mKW4",subtabs:"subtabs_XtJb",playgroundEditor:"playgroundEditor_lYwu",closed:"closed_QJMa",arrow:"arrow_tivA",vertical:"vertical_OMeC",right:"right_vs_C",left:"left_iDcB",up:"up_H4F7",down:"down_oRky",playgroundPreview:"playgroundPreview_rk9R",playgroundError:"playgroundError_sRnA",playgroundResult:"playgroundResult_tefG",debugToggle:"debugToggle_zlro",title:"title_poUY",tabs:"tabs_m54V",tab:"tab_bTGw",selected:"selected_QXZk",fixtureBlock:"fixtureBlock_mpRK",fixtureItem:"fixtureItem_Jd6V",fixtureHeader:"fixtureHeader_KYel",fixtureJson:"fixtureJson_HnbR"}},73795:(e,t,n)=>{var r={"./core.d.ts":[90734,30007],"./endpoint.d.ts":[73118,72901],"./graphql.d.ts":[60467,99076],"./hooks.d.ts":[56890,22595],"./normalizr.d.ts":[14991,12192],"./react.d.ts":[61019,97359],"./rest.d.ts":[42714,46324]};function s(e){if(!n.o(r,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],s=t[0];return n.e(t[1]).then((()=>n.t(s,23)))}s.keys=()=>Object.keys(r),s.id=73795,e.exports=s},41191:(e,t,n)=>{"use strict";n.d(t,{Z:()=>x});var r=n(70760),s=n(11857);function i(e,t){e.type=e.sideEffect?"mutate":"read",e.options={...t},delete e.options.key,delete e.options.schema,delete e.options.sideEffect,delete e.options.fetch,delete e.options.getFetchKey,delete e.options.options,0===Object.keys(e.options).length&&delete e.options,void 0===e.schema&&(e.schema=null)}let o=!1;try{Function()}catch(E){o=!0,console.error("Content Security Policy: The previous CSP log can be safely ignored - @rest-hooks/endpoint will use setPrototypeOf instead")}class a extends Function{constructor(e,t){let n;return o?(n=function(){return n.fetch(...arguments)},Object.setPrototypeOf(n,new.target.prototype)):(super("return arguments.callee.fetch.apply(arguments.callee, arguments)"),n=this),n.getFetchKey=e=>n.key(e),e&&(n.fetch=e),t&&"name"in t?(n.__name=t.name,delete t.name):e&&(n.__name=e.name),Object.assign(n,t),Object.defineProperty(n,"name",{get:function(){return this.__name}}),i(n,t),n}key(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return`${this.name} ${JSON.stringify(t)}`}bind(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const s=this.fetch,i=this.key;return this.extend({fetch(){return s.apply(null!=e?e:this,n)},key(){return i.apply(this,n)}})}extend(e){class t extends this.constructor{}Object.assign(t.prototype,this);const n=new t(e.fetch,e);return i(n,{...this.options,...e}),n}}var l=n(92586);class c extends Error{constructor(e){super(e.statusText||`Network response not 'ok': ${e.status}`),this.name="NetworkError",this.status=e.status,this.response=e}}function u(e){return!("function"!=typeof e.hasOwnProperty||!(Object.hasOwnProperty.call(e,"__ownerID")||e._map&&Object.hasOwnProperty.call(e._map,"__ownerID")))}const d=e=>{let[t,,n]=e;return void 0!==t&&!n};const p=(e,t,n)=>{if(u(t))return function(e,t,n){let r=!0,s=!1;return[Object.keys(e).reduce(((t,i)=>{const o=`${i}`,[a,l,c]=n(t.get(o),e[o]);return l||(r=!1),c&&(s=!0),t.has(o)?t.set(o,a):t}),t),r,s]}(e,t,n);const r={...t};let s=!0,i=!1;return Object.keys(e).forEach((t=>{const[o,a,l]=n(r[t],e[t]);void 0!==r[t]&&(r[t]=o),l&&(i=!0),a||(s=!1)})),[r,s,i]};function m(e){if("object"!=typeof e)return!1;if(void 0===e||e instanceof class extends class{constructor(e,t){this.schema=void 0,t&&(this._schemaAttribute="string"==typeof t?e=>e[t]:t),this.define(e)}get isSingleSchema(){return!this._schemaAttribute}define(e){this.schema=e}getSchemaAttribute(e,t,n){return!this.isSingleSchema&&this._schemaAttribute(e,t,n)}inferSchema(e,t,n){if(this.isSingleSchema)return this.schema;const r=this.getSchemaAttribute(e,t,n);return this.schema[r]}normalizeValue(e,t,n,r,s,i){const o=this.inferSchema(e,t,n);if(!o)return e;const a=r(e,t,n,o,s,i);return this.isSingleSchema||null==a?a:{id:a,schema:this.getSchemaAttribute(e,t,n)}}denormalizeValue(e,t){const n=!this.isSingleSchema&&(u(e)?e.get("schema"):e.schema);return this.isSingleSchema||n?t((this.isSingleSchema?void 0:u(e)?e.get("id"):e.id)||e,this.isSingleSchema?this.schema:this.schema[n]):[e,!0,!1]}}{normalize(e,t,n,r,s,i){const o=(e=>Array.isArray(e)?e:Object.keys(e).map((t=>e[t])))(e);return o.map(((e,o)=>this.normalizeValue(e,t,n,r,s,i))).filter((e=>null!=e))}denormalize(e,t){return[e.map?e.map((e=>this.denormalizeValue(e,t))).filter(d).map((e=>{let[t]=e;return t})):e,!0,!1]}infer(e,t,n,r){}toJSON(){return[this.schema]}}||Array.isArray(e))return[];const t=e instanceof class{constructor(e){this.schema=void 0,this.define(e)}define(e){this.schema=Object.keys(e).reduce(((t,n)=>({...t,[n]:e[n]})),this.schema||{})}normalize(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return((e,t,n,r,s,i,o)=>{const a={...t};return Object.keys(e).forEach((n=>{const r=e[n],l=s(t[n],t,n,r,i,o);null==l?delete a[n]:a[n]=l})),a})(this.schema,...t)}denormalize(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return p(this.schema,...t)}infer(e,t,n,r){return function(e,t,n,r,s){const i={};for(const o of Object.keys(e))i[o]=r(e[o],t,n,s);return i}(this.schema,e,t,n,r)}}?e.schema:e;for(const n in t){if(!t[n])continue;const e=m(t[n]);if(!1!==e)return e.unshift(n),e}return!1}function h(e,t){const n=m(e.schema);if(!1===n)throw new Error("schema has no array");return function(r){for(var s=arguments.length,i=new Array(s>1?s-1:0),o=1;o<s;o++)i[o-1]=arguments[o];return{[e.key(...t(...i))]:e=>{const t=g(e,n),s=new Set(t),i=g(r,n).filter((e=>!s.has(e))),o=[...t,...i];return f(r,n,o)}}}}const g=(e,t)=>{let n=e;for(const r of t){if(!n)return[];n=n[r]}return n||[]},f=(e,t,n)=>{if(0===t.length)return n;const r={...e};let s=r;for(let i=0;i<t.length-1;i++){const e=t[i];s=s[e]={...s[e]}}return s[t[t.length-1]]=n,r};const y={};const b={};const k=Object.prototype,v=Object.getPrototypeOf;var w=(0,s.Z)("hasBody");class x extends a{constructor(e){var t;super(null!=(t=e.fetch)?t:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const s=(0,r.Z)(this,w)[w]&&t.length<2?{}:t[0]||{},i=(0,r.Z)(this,w)[w]?t[t.length-1]:void 0;return this.fetchResponse(this.url(s),this.getRequestInit(i)).then((e=>this.parseResponse(e))).then((e=>this.process(e,...t)))},e),Object.defineProperty(this,w,{writable:!0,value:void 0}),"sideEffect"in this||(this.sideEffect="GET"!==e.method&&void 0!==e.method||void 0),void 0===this.method&&(this.method=this.sideEffect?"POST":"GET"),void 0===this.urlPrefix&&(this.urlPrefix=""),(0,r.Z)(this,w)[w]=!("body"in this&&void 0===this.body||["GET","DELETE"].includes(this.method))}key(){return`${this.method} ${this.url((0,r.Z)(this,w)[w]&&arguments.length<2?{}:(arguments.length<=0?void 0:arguments[0])||{})}`}url(e){void 0===e&&(e={});const t=(n=this.path,Object.hasOwn(y,n)||(y[n]=(0,l.MY)(n,{encode:encodeURIComponent,validate:!1})),y[n])(e);var n;const r=function(e){return Object.hasOwn(b,e)||(b[e]=new Set((0,l.Qc)(e).map((e=>"string"==typeof e?e:`${e.name}`)))),b[e]}(this.path),s={};return Object.keys(e).forEach((t=>{r.has(t)||(s[t]=e[t])})),Object.keys(s).length?`${this.urlPrefix}${t}?${function(e){const t=new URLSearchParams(e);return t.sort(),t.toString()}(s)}`:`${this.urlPrefix}${t}`}getHeaders(e){return e}getRequestInit(e){const t=null!==(n=e)&&"object"==typeof n&&v(n)===k;var n;t&&(e=JSON.stringify(e));const r={...this.requestInit,method:this.method,signal:this.signal,body:e};return e&&!t||(r.headers={"Content-Type":"application/json",...r.headers}),r.headers=this.getHeaders(r.headers),r}fetchResponse(e,t){return fetch(e,t).then((e=>{if(!e.ok)throw new c(e);return e})).catch((e=>{throw e instanceof TypeError&&(e.status=500),e}))}parseResponse(e){var t;return 204===e.status?Promise.resolve(null):null!=(t=e.headers.get("content-type"))&&t.includes("json")?e.json().catch((e=>{throw e.status=400,e})):e.text().then((t=>{if(["string","undefined"].includes(typeof this.schema)||null===this.schema)return t;const n=new c(e);throw n.status=404,n.message=`Unexpected text response for schema ${this.schema}`,n}))}process(e){return e}errorPolicy(e){return e.status>=500?"soft":void 0}get pathRegex(){return(0,l.Bo)(this.path)}testKey(e){const t=this.method+" "+this.urlPrefix;if(!e.startsWith(t))return!1;let n=e.lastIndexOf("?");return-1===n&&(n=void 0),this.pathRegex.test(e.substring(t.length,n))}extend(e){class t extends this.constructor{}Object.assign(t.prototype,this);return new t(this.name?{name:this.name,fetch:this.fetch,...e}:{fetch:this.fetch,...e})}paginated(e){return this.extend({update:h(this,e)})}}}}]);