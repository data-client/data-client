/*! For license information please see aabf798d.f92753b2.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[68311],{41535:(e,t)=>{var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,y={};function h(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||m}function b(){}function v(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||m}h.prototype.isReactComponent={},h.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},h.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=h.prototype;var w=v.prototype=new b;w.constructor=v,g(w,h.prototype),w.isPureReactComponent=!0;var k=Array.isArray,S=Object.prototype.hasOwnProperty,M={current:null},O={key:!0,ref:!0,__self:!0,__source:!0};function x(e,t,r){var a,o={},s=null,i=null;if(null!=t)for(a in void 0!==t.ref&&(i=t.ref),void 0!==t.key&&(s=""+t.key),t)S.call(t,a)&&!O.hasOwnProperty(a)&&(o[a]=t[a]);var l=arguments.length-2;if(1===l)o.children=r;else if(1<l){for(var c=Array(l),p=0;p<l;p++)c[p]=arguments[p+2];o.children=c}if(e&&e.defaultProps)for(a in l=e.defaultProps)void 0===o[a]&&(o[a]=l[a]);return{$$typeof:n,type:e,key:s,ref:i,props:o,_owner:M.current}}function _(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var j=/\/+/g;function P(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function E(e,t,a,o,s){var i=typeof e;"undefined"!==i&&"boolean"!==i||(e=null);var l=!1;if(null===e)l=!0;else switch(i){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return s=s(l=e),e=""===o?"."+P(l,0):o,k(s)?(a="",null!=e&&(a=e.replace(j,"$&/")+"/"),E(s,t,a,"",(function(e){return e}))):null!=s&&(_(s)&&(s=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,a+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(j,"$&/")+"/")+e)),t.push(s)),1;if(l=0,o=""===o?".":o+":",k(e))for(var c=0;c<e.length;c++){var p=o+P(i=e[c],c);l+=E(i,t,a,p,s)}else if(p=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"==typeof p)for(e=p.call(e),c=0;!(i=e.next()).done;)l+=E(i=i.value,t,a,p=o+P(i,c++),s);else if("object"===i)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function N(e,t,n){if(null==e)return e;var r=[],a=0;return E(e,r,"","",(function(e){return t.call(n,e,a++)})),r}function R(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var C={current:null},T={transition:null}},27378:(e,t,n)=>{n(41535)},76751:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>c});var r=n(87462),a=(n(27378),n(3905));const o={title:"Managers, Middleware, and Flux",sidebar_label:"Managers and Middleware"},s=void 0,i={unversionedId:"concepts/managers",id:"concepts/managers",title:"Managers, Middleware, and Flux",description:"Rest Hooks uses the flux store pattern, which is",source:"@site/../docs/core/concepts/managers.md",sourceDirName:"concepts",slug:"/concepts/managers",permalink:"/docs/concepts/managers",draft:!1,editUrl:"https://github.com/coinbase/rest-hooks/edit/master/docs/concepts/managers.md",tags:[],version:"current",lastUpdatedBy:"Nathaniel Tucker",lastUpdatedAt:1671554583,formattedLastUpdatedAt:"Dec 20, 2022",frontMatter:{title:"Managers, Middleware, and Flux",sidebar_label:"Managers and Middleware"},sidebar:"docs",previous:{title:"Validation",permalink:"/docs/concepts/validation"},next:{title:"Handling loading state",permalink:"/docs/concepts/loading-state"}},l={},c=[{value:"Examples",id:"examples",level:2},{value:"Middleware logging",id:"middleware-logging",level:3},{value:"Middleware data stream (push-based)",id:"data-stream",level:3}],p={toc:c};function u(e){let{components:t,...o}=e;return(0,a.kt)("wrapper",(0,r.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Rest Hooks uses the ",(0,a.kt)("a",{parentName:"p",href:"https://facebook.github.io/flux/docs/in-depth-overview/"},"flux store")," pattern, which is\ncharacterized by an easy to understand and debug ",(0,a.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Unidirectional_Data_Flow_(computer_science)"},"undirectional data flow"),". State updates are performed by a reducer function."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Manager flux flow",src:n(3214).Z,width:"1600",height:"686"})),(0,a.kt)("p",null,"Rest Hooks improves type-safety and ergonomics by performing dispatches and store access with\nits ",(0,a.kt)("a",{parentName:"p",href:"/docs/api/Controller"},"Controller")),(0,a.kt)("p",null,"Finally, everything is orchestrated by ",(0,a.kt)("a",{parentName:"p",href:"/docs/api/Manager"},"Managers"),". Managers integrate with the flux\nlifecycle by intercepting and dispatching actions, as well as reading the internal state."),(0,a.kt)("p",null,"This central orchestration is how Rest Hooks is able to coordinate with all components, doing things\nlike automatic fetch deduplication, polling fetch coordinating eliminating many cases of overfetching."),(0,a.kt)("p",null,"It also means Rest Hooks behavior can be arbitrarily customized by writing your own Managers."),(0,a.kt)("h2",{id:"examples"},"Examples"),(0,a.kt)("h3",{id:"middleware-logging"},"Middleware logging"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import type { Manager, Middleware } from '@rest-hooks/core';\n\nexport default class LoggingManager implements Manager {\n  getMiddleware = (): Middleware => controller => next => async action => {\n    console.log('before', action, controller.getState());\n    await next(action);\n    console.log('after', action, controller.getState());\n  };\n\n  cleanup() {}\n}\n")),(0,a.kt)("h3",{id:"data-stream"},"Middleware data stream (push-based)"),(0,a.kt)("p",null,"Adding a manager to process data pushed from the server by ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API"},"websockets"),"\nor ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events"},"Server Sent Events")," ensures\nwe can maintain fresh data when the data updates are independent of user action. For example, a trading app's\nprice, or a real-time collaborative editor."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import type { Manager, Middleware } from '@rest-hooks/core';\nimport type { EndpointInterface } from '@rest-hooks/endpoint';\n\nexport default class StreamManager implements Manager {\n  protected declare middleware: Middleware;\n  protected declare evtSource: WebSocket | EventSource;\n  protected declare endpoints: Record<string, EndpointInterface>;\n\n  constructor(\n    evtSource: WebSocket | EventSource,\n    endpoints: Record<string, EndpointInterface>,\n  ) {\n    this.evtSource = evtSource;\n    this.endpoints = endpoints;\n\n    // highlight-start\n    this.middleware = controller => {\n      this.evtSource.onmessage = event => {\n        try {\n          const msg = JSON.parse(event.data);\n          if (msg.type in this.endpoints)\n            controller.setResponse(this.endpoints[msg.type], ...msg.args, msg.data);\n        } catch (e) {\n          console.error('Failed to handle message');\n          console.error(e);\n        }\n      };\n      return next => async action => next(action);\n    };\n    // highlight-end\n  }\n\n  cleanup() {\n    this.evtSource.close();\n  }\n\n  getMiddleware() {\n    return this.middleware;\n  }\n}\n")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"/docs/api/Controller#setResponse"},"Controller.setResponse()")," updates the Rest Hooks store\nwith ",(0,a.kt)("inlineCode",{parentName:"p"},"event.data"),"."))}u.isMDXComponent=!0},3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>f});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=c(n),f=a,m=d["".concat(l,".").concat(f)]||d[f]||u[f]||o;return n?r.createElement(m,s(s({ref:t},p),{},{components:n})):r.createElement(m,s({ref:t},p))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,s=new Array(o);s[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:a,s[1]=i;for(var c=2;c<o;c++)s[c]=n[c];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},3214:(e,t,n)=>{t.Z=n.p+"assets/images/managers-12ec42d958a182bcb3eb9a337a73cb90.png"}}]);