/*! For license information please see e34b89fc.0abd3e64.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[63635],{41535:(e,t)=>{var r=Symbol.for("react.element"),a=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),s=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),m=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},h=Object.assign,g={};function v(e,t,r){this.props=e,this.context=t,this.refs=g,this.updater=r||f}function y(){}function b(e,t,r){this.props=e,this.context=t,this.refs=g,this.updater=r||f}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var k=b.prototype=new y;k.constructor=b,h(k,v.prototype),k.isPureReactComponent=!0;var w=Array.isArray,x=Object.prototype.hasOwnProperty,M={current:null},P={key:!0,ref:!0,__self:!0,__source:!0};function N(e,t,a){var n,o={},i=null,l=null;if(null!=t)for(n in void 0!==t.ref&&(l=t.ref),void 0!==t.key&&(i=""+t.key),t)x.call(t,n)&&!P.hasOwnProperty(n)&&(o[n]=t[n]);var s=arguments.length-2;if(1===s)o.children=a;else if(1<s){for(var c=Array(s),p=0;p<s;p++)c[p]=arguments[p+2];o.children=c}if(e&&e.defaultProps)for(n in s=e.defaultProps)void 0===o[n]&&(o[n]=s[n]);return{$$typeof:r,type:e,key:i,ref:l,props:o,_owner:M.current}}function S(e){return"object"==typeof e&&null!==e&&e.$$typeof===r}var C=/\/+/g;function O(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function T(e,t,n,o,i){var l=typeof e;"undefined"!==l&&"boolean"!==l||(e=null);var s=!1;if(null===e)s=!0;else switch(l){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case r:case a:s=!0}}if(s)return i=i(s=e),e=""===o?"."+O(s,0):o,w(i)?(n="",null!=e&&(n=e.replace(C,"$&/")+"/"),T(i,t,n,"",(function(e){return e}))):null!=i&&(S(i)&&(i=function(e,t){return{$$typeof:r,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(i,n+(!i.key||s&&s.key===i.key?"":(""+i.key).replace(C,"$&/")+"/")+e)),t.push(i)),1;if(s=0,o=""===o?".":o+":",w(e))for(var c=0;c<e.length;c++){var p=o+O(l=e[c],c);s+=T(l,t,n,p,i)}else if(p=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=m&&e[m]||e["@@iterator"])?e:null}(e),"function"==typeof p)for(e=p.call(e),c=0;!(l=e.next()).done;)s+=T(l=l.value,t,n,p=o+O(l,c++),i);else if("object"===l)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return s}function j(e,t,r){if(null==e)return e;var a=[],n=0;return T(e,a,"","",(function(e){return t.call(r,e,n++)})),a}function _(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var E={current:null},R={transition:null}},27378:(e,t,r)=>{r(41535)},30433:(e,t,r)=>{r.d(t,{Z:()=>i});var a=r(67294),n=r(86010),o="tabItem_Ymn6";function i(e){let{children:t,hidden:r,className:i}=e;return a.createElement("div",{role:"tabpanel",className:(0,n.Z)(o,i),hidden:r},t)}},65559:(e,t,r)=>{r.d(t,{Z:()=>m});var a=r(87462),n=r(67294),o=r(86010),i=r(5730),l=r(20636),s=r(76602),c=r(63735),p="tabList__CuJ",d="tabItem_LNqP";function u(e){const{lazy:t,block:r,defaultValue:i,values:u,groupId:m,className:f}=e,h=n.Children.map(e.children,(e=>{if((0,n.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),g=u??h.map((e=>{let{props:{value:t,label:r,attributes:a}}=e;return{value:t,label:r,attributes:a}})),v=(0,l.l)(g,((e,t)=>e.value===t.value));if(v.length>0)throw new Error(`Docusaurus error: Duplicate values "${v.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const y=null===i?i:i??h.find((e=>e.props.default))?.props.value??h[0].props.value;if(null!==y&&!g.some((e=>e.value===y)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${y}" but none of its children has the corresponding value. Available values are: ${g.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:b,setTabGroupChoices:k}=(0,s.U)(),[w,x]=(0,n.useState)(y),M=[],{blockElementScrollPositionUntilNextRender:P}=(0,c.o5)();if(null!=m){const e=b[m];null!=e&&e!==w&&g.some((t=>t.value===e))&&x(e)}const N=e=>{const t=e.currentTarget,r=M.indexOf(t),a=g[r].value;a!==w&&(P(t),x(a),null!=m&&k(m,String(a)))},S=e=>{let t=null;switch(e.key){case"Enter":N(e);break;case"ArrowRight":{const r=M.indexOf(e.currentTarget)+1;t=M[r]??M[0];break}case"ArrowLeft":{const r=M.indexOf(e.currentTarget)-1;t=M[r]??M[M.length-1];break}}t?.focus()};return n.createElement("div",{className:(0,o.Z)("tabs-container",p)},n.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":r},f)},g.map((e=>{let{value:t,label:r,attributes:i}=e;return n.createElement("li",(0,a.Z)({role:"tab",tabIndex:w===t?0:-1,"aria-selected":w===t,key:t,ref:e=>M.push(e),onKeyDown:S,onClick:N},i,{className:(0,o.Z)("tabs__item",d,i?.className,{"tabs__item--active":w===t})}),r??t)}))),t?(0,n.cloneElement)(h.filter((e=>e.props.value===w))[0],{className:"margin-top--md"}):n.createElement("div",{className:"margin-top--md"},h.map(((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==w})))))}function m(e){const t=(0,i.Z)();return n.createElement(u,(0,a.Z)({key:String(t)},e))}},19782:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>m,frontMatter:()=>l,metadata:()=>c,toc:()=>d});var a=r(87462),n=(r(27378),r(3905)),o=r(65559),i=r(30433);const l={title:"Manager"},s=void 0,c={unversionedId:"api/Manager",id:"api/Manager",title:"Manager",description:"Manager - Powerful middlewares with global store knowledge",source:"@site/../docs/core/api/Manager.md",sourceDirName:"api",slug:"/api/Manager",permalink:"/docs/api/Manager",draft:!1,editUrl:"https://github.com/coinbase/rest-hooks/edit/master/docs/api/Manager.md",tags:[],version:"current",lastUpdatedBy:"Nathaniel Tucker",lastUpdatedAt:1670603746,formattedLastUpdatedAt:"Dec 9, 2022",frontMatter:{title:"Manager"},sidebar:"docs",previous:{title:"<NetworkErrorBoundary />",permalink:"/docs/api/NetworkErrorBoundary"},next:{title:"NetworkManager",permalink:"/docs/api/NetworkManager"}},p={},d=[{value:"getMiddleware()",id:"getmiddleware",level:2},{value:"cleanup()",id:"cleanup",level:2},{value:"init()",id:"init",level:2},{value:"Provided managers",id:"provided-managers",level:2},{value:"Adding managers to Rest Hooks",id:"adding-managers-to-rest-hooks",level:2},{value:"Control flow",id:"control-flow",level:2},{value:"Middleware logging",id:"middleware-logging",level:3},{value:"Middleware data stream (push-based)",id:"data-stream",level:3}],u={toc:d};function m(e){let{components:t,...l}=e;return(0,n.kt)("wrapper",(0,a.Z)({},u,l,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("head",null,(0,n.kt)("title",null,"Manager - Powerful middlewares with global store knowledge"),(0,n.kt)("meta",{name:"docsearch:pagerank",content:"20"})),(0,n.kt)("p",null,"Managers are singletons that orchestrate the complex asynchronous behavior of ",(0,n.kt)("inlineCode",{parentName:"p"},"rest-hooks"),".\nSeveral managers are provided by ",(0,n.kt)("inlineCode",{parentName:"p"},"rest-hooks")," and used by default; however there is nothing\nstopping other compatible managers to be built that expand the functionality. We encourage\nPRs or complimentary libraries!"),(0,n.kt)("p",null,"While managers often have complex internal state and methods - the exposed interface is quite simple.\nBecause of this, it is encouraged to keep any supporting state or methods marked at protected by\ntypescript. Managers have three exposed pieces - the constructor to build initial state and\ntake any parameters; a simple cleanup() method to tear down any dangling pieces like setIntervals()\nor unresolved Promises; and finally getMiddleware() - providing the mechanism to hook into\nthe flux data flow."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript"},"type Dispatch = (action: ActionTypes) => Promise<void>;\n\ntype Middleware = <R extends React.Reducer<State<unknown>, ActionTypes>>(\n  controller: Controller,\n) => (next: Dispatch<R>) => Dispatch<R>;\n\ninterface Manager {\n  getMiddleware(): Middleware;\n  cleanup(): void;\n  init?: (state: State<any>) => void;\n}\n")),(0,n.kt)("h2",{id:"getmiddleware"},"getMiddleware()"),(0,n.kt)("p",null,"getMiddleware() returns a function that very similar to a ",(0,n.kt)("a",{parentName:"p",href:"https://redux.js.org/advanced/middleware"},"redux middleware"),".\nThe only differences is that the ",(0,n.kt)("inlineCode",{parentName:"p"},"next()")," function returns a ",(0,n.kt)("inlineCode",{parentName:"p"},"Promise"),". This promise resolves when the reducer update is\n",(0,n.kt)("a",{parentName:"p",href:"https://indepth.dev/inside-fiber-in-depth-overview-of-the-new-reconciliation-algorithm-in-react/#general-algorithm"},"committed"),"\nwhen using <CacheProvider /",">",". This is necessary since the commit phase is asynchronously scheduled. This enables building\nmanagers that perform work after the DOM is updated and also with the newly computed state."),(0,n.kt)("p",null,"Since redux is fully synchronous, an adapter must be placed in front of Rest Hooks style middleware to\nensure they can consume a promise. Conversely, redux middleware must be changed to pass through promises."),(0,n.kt)("p",null,"Middlewares will intercept actions that are dispatched and then potentially dispatch their own actions as well.\nTo read more about middlewares, see the ",(0,n.kt)("a",{parentName:"p",href:"https://redux.js.org/advanced/middleware"},"redux documentation"),"."),(0,n.kt)("h2",{id:"cleanup"},"cleanup()"),(0,n.kt)("p",null,"Provides any cleanup of dangling resources after manager is no longer in use."),(0,n.kt)("h2",{id:"init"},"init()"),(0,n.kt)("p",null,"Called with initial state after provider is mounted. Can be useful to run setup at start that\nrelies on state actually existing."),(0,n.kt)("h2",{id:"provided-managers"},"Provided managers"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/api/NetworkManager"},"NetworkManager")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/api/SubscriptionManager"},"SubscriptionManager")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/api/DevToolsManager"},"DevToolsManager")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/api/LogoutManager"},"LogoutManager"))),(0,n.kt)("h2",{id:"adding-managers-to-rest-hooks"},"Adding managers to Rest Hooks"),(0,n.kt)("p",null,"Use the ",(0,n.kt)("a",{parentName:"p",href:"/docs/api/CacheProvider#managers"},"managers")," prop of ",(0,n.kt)("a",{parentName:"p",href:"/docs/api/CacheProvider"},"CacheProvider"),". Be\nsure to hoist to module level or wrap in a useMemo() to ensure they are not recreated. Managers\nhave internal state, so it is important to not constantly recreate them."),(0,n.kt)(o.Z,{defaultValue:"18-web",groupId:"platform",values:[{label:"React Web 16+",value:"web"},{label:"React Web 18+",value:"18-web"},{label:"React Native",value:"native"},{label:"NextJS",value:"nextjs"}],mdxType:"Tabs"},(0,n.kt)(i.Z,{value:"web",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="/index.tsx"',title:'"/index.tsx"'},"import { CacheProvider } from '@rest-hooks/react';\nimport ReactDOM from 'react-dom';\n\nconst managers = [...CacheProvider.defaultProps.managers, MyManager];\n\nReactDOM.render(\n  <CacheProvider managers={managers}>\n    <App />\n  </CacheProvider>,\n  document.body,\n);\n"))),(0,n.kt)(i.Z,{value:"18-web",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="/index.tsx"',title:'"/index.tsx"'},"import { CacheProvider } from '@rest-hooks/react';\nimport ReactDOM from 'react-dom';\n\nconst managers = [...CacheProvider.defaultProps.managers, MyManager];\n\nReactDOM.createRoot(document.body).render(\n  <CacheProvider managers={managers}>\n    <App />\n  </CacheProvider>,\n);\n"))),(0,n.kt)(i.Z,{value:"native",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="/index.tsx"',title:'"/index.tsx"'},"import { CacheProvider } from '@rest-hooks/react';\nimport { AppRegistry } from 'react-native';\n\nconst managers = [...CacheProvider.defaultProps.managers, MyManager];\n\nconst Root = () => (\n  <CacheProvider managers={managers}>\n    <App />\n  </CacheProvider>\n);\nAppRegistry.registerComponent('MyApp', () => Root);\n"))),(0,n.kt)(i.Z,{value:"nextjs",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="pages/_app.tsx"',title:'"pages/_app.tsx"'},"import { CacheProvider } from '@rest-hooks/react';\nimport { AppCacheProvider } from '@rest-hooks/ssr/nextjs';\nimport type { AppProps } from 'next/app';\n\nconst managers = [...CacheProvider.defaultProps.managers, MyManager];\n\nexport default function App({ Component, pageProps }: AppProps) {\n  return (\n    <AppCacheProvider managers={managers}>\n      <Component {...pageProps} />\n    </AppCacheProvider>\n  );\n}\n")))),(0,n.kt)("h2",{id:"control-flow"},"Control flow"),(0,n.kt)("p",null,"Managers live in the CacheProvider centralized store. They orchestrate complex control flows by interfacing\nvia intercepting and dispatching actions, as well as reading the internal state."),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Manager flux flow",src:r(3214).Z,width:"1600",height:"686"})),(0,n.kt)("h3",{id:"middleware-logging"},"Middleware logging"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript"},"import type { Manager, Middleware } from '@rest-hooks/core';\n\nexport default class LoggingManager implements Manager {\n  getMiddleware = (): Middleware => controller => next => async action => {\n    console.log('before', action, controller.getState());\n    await next(action);\n    console.log('after', action, controller.getState());\n  };\n\n  cleanup() {}\n}\n")),(0,n.kt)("h3",{id:"data-stream"},"Middleware data stream (push-based)"),(0,n.kt)("p",null,"Adding a manager to process data pushed from the server by ",(0,n.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API"},"websockets"),"\nor ",(0,n.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events"},"Server Sent Events")," ensures\nwe can maintain fresh data when the data updates are independent of user action. For example, a trading app's\nprice, or a real-time collaborative editor."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript"},"import type { Manager, Middleware } from '@rest-hooks/core';\nimport type { EndpointInterface } from '@rest-hooks/endpoint';\n\nexport default class StreamManager implements Manager {\n  protected declare middleware: Middleware;\n  protected declare evtSource: WebSocket | EventSource;\n  protected declare endpoints: Record<string, EndpointInterface>;\n\n  constructor(\n    evtSource: WebSocket | EventSource,\n    endpoints: Record<string, EndpointInterface>,\n  ) {\n    this.evtSource = evtSource;\n    this.endpoints = endpoints;\n\n    // highlight-start\n    this.middleware = controller => {\n      this.evtSource.onmessage = event => {\n        try {\n          const msg = JSON.parse(event.data);\n          if (msg.type in this.endpoints)\n            controller.receive(this.endpoints[msg.type], ...msg.args, msg.data);\n        } catch (e) {\n          console.error('Failed to handle message');\n          console.error(e);\n        }\n      };\n      return next => async action => next(action);\n    };\n    // highlight-end\n  }\n\n  cleanup() {\n    this.evtSource.close();\n  }\n\n  getMiddleware() {\n    return this.middleware;\n  }\n}\n")),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"/docs/api/Controller#receive"},"Controller.receive()")," updates the Rest Hooks store\nwith ",(0,n.kt)("inlineCode",{parentName:"p"},"event.data"),"."))}m.isMDXComponent=!0},3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>m});var a=r(67294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var s=a.createContext({}),c=function(e){var t=a.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=c(r),m=n,f=u["".concat(s,".").concat(m)]||u[m]||d[m]||o;return r?a.createElement(f,i(i({ref:t},p),{},{components:r})):a.createElement(f,i({ref:t},p))}));function m(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,i=new Array(o);i[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:n,i[1]=l;for(var c=2;c<o;c++)i[c]=r[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,r)}u.displayName="MDXCreateElement"},3214:(e,t,r)=>{t.Z=r.p+"assets/images/managers-12ec42d958a182bcb3eb9a337a73cb90.png"}}]);