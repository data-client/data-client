"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[93755],{85903:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>f,frontMatter:()=>p,metadata:()=>u,toc:()=>m});var a=n(87462),r=(n(67294),n(3905)),s=n(22808),o=n(30433);const i={toc:[]};function l(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},i,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("mermaid",{value:'flowchart TB\n    URL--\x3eresponse\n    INIT--\x3eresponse\n    subgraph Prepare Fetch\n      subgraph URL\n        direction BT\n        urlPrefix--\x3eurl("url(...args)")\n        path--\x3eurl\n      end\n      subgraph INIT\n      direction BT\n        getHeaders("getHeaders()")--\x3ereqinit("getRequestInit(...args)")\n        method--\x3ereqinit\n        signal--\x3ereqinit\n      end\n    end\n    subgraph Perform Fetch\n    response("fetchResponse()")--\x3eparse("parseResponse()")\n    parse--\x3eprocess("process()")\n    end\n    click url "/rest/api/RestEndpoint#url"\n    click urlPrefix "/rest/api/RestEndpoint#urlPrefix"\n    click path "/rest/api/RestEndpoint#path"\n    click getHeaders "/rest/api/RestEndpoint#getHeaders"\n    click method "/rest/api/RestEndpoint#method"\n    click signal "https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal"\n    click reqinit "/rest/api/RestEndpoint#getRequestInit"\n    click response "/rest/api/RestEndpoint#fetchResponse"\n    click parse "/rest/api/RestEndpoint#parseResponse"\n    click process "/rest/api/RestEndpoint#process"'}))}l.isMDXComponent=!0;const p={title:"RestEndpoint",description:"Strongly typed path-based API definitions."},d=void 0,u={unversionedId:"api/RestEndpoint",id:"version-6.0/api/RestEndpoint",title:"RestEndpoint",description:"Strongly typed path-based API definitions.",source:"@site/rest_versioned_docs/version-6.0/api/RestEndpoint.md",sourceDirName:"api",slug:"/api/RestEndpoint",permalink:"/rest/6.0/api/RestEndpoint",draft:!1,editUrl:"https://github.com/data-client/rest-hooks/edit/master/docs/rest/api/RestEndpoint.md",tags:[],version:"6.0",lastUpdatedBy:"Nathaniel Tucker",lastUpdatedAt:1667922965,formattedLastUpdatedAt:"Nov 8, 2022",frontMatter:{title:"RestEndpoint",description:"Strongly typed path-based API definitions."},sidebar:"docs",previous:{title:"Summary List Endpoints",permalink:"/rest/6.0/guides/summary-list"},next:{title:"Endpoint",permalink:"/rest/6.0/api/Endpoint"}},c={},m=[{value:"Usage",id:"usage",level:2},{value:"Simplest retrieval",id:"simplest-retrieval",level:3},{value:"Managing state",id:"managing-state",level:3},{value:"Typing",id:"typing",level:3},{value:"Resolution/Return",id:"resolutionreturn",level:4},{value:"Function Parameters",id:"function-parameters",level:4},{value:"Fetch Lifecycle",id:"fetch-lifecycle",level:2},{value:"Prepare Fetch",id:"prepare-fetch",level:2},{value:"url(params): string",id:"url",level:3},{value:"path: string",id:"path",level:3},{value:"urlPrefix: string = &#39;&#39;",id:"urlPrefix",level:3},{value:"method: string = &#39;GET&#39;",id:"method",level:3},{value:"getRequestInit(body): RequestInit",id:"getRequestInit",level:3},{value:"getHeaders(headers: HeadersInit): HeadersInit",id:"getHeaders",level:3},{value:"Handle fetch",id:"handle-fetch",level:2},{value:"fetchResponse(input, init): Promise",id:"fetchResponse",level:3},{value:"parseResponse(response): Promise",id:"parseResponse",level:3},{value:"process(value, ...args): any",id:"process",level:3},{value:"schema?: Schema",id:"schema",level:2},{value:"Endpoint Life-Cycles",id:"endpoint-life-cycles",level:2},{value:"dataExpiryLength?: number",id:"dataexpirylength",level:3},{value:"errorExpiryLength?: number",id:"errorexpirylength",level:3},{value:"errorPolicy?: (error: any) =&gt; &#39;soft&#39; | undefined",id:"errorpolicy",level:3},{value:"invalidIfStale: boolean",id:"invalidifstale",level:3},{value:"pollFrequency: number",id:"pollfrequency",level:3},{value:"getOptimisticResponse: (snap, ...args) =&gt; fakePayload",id:"getoptimisticresponse",level:3},{value:"update(normalizedResponseOfThis, ...args) =&gt; ({ endpointKey: (normalizedResponseOfEndpointToUpdate) =&gt; updatedNormalizedResponse) })",id:"update",level:3},{value:"extend(options): Endpoint",id:"extend",level:2},{value:"paginated(removeCursor): args",id:"paginated",level:2},{value:"Inheritance",id:"inheritance",level:2}],h={toc:m};function f(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("head",null,(0,r.kt)("title",null,"RestEndpoint - Strongly typed path-based HTTP API definitions"),(0,r.kt)("meta",{name:"docsearch:pagerank",content:"20"})),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"RestEndpoints")," are for ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP"},"HTTP")," based protocols like REST."),(0,r.kt)(s.Z,{defaultValue:"RestEndpoint",values:[{label:"RestEndpoint",value:"RestEndpoint"},{label:"Endpoint",value:"Endpoint"}],mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"RestEndpoint",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"interface RestGenerics {\n  readonly path: string;\n  readonly schema?: Schema | undefined;\n  readonly method?: string;\n  readonly body?: any;\n}\n\nexport class RestEndpoint<O extends RestGenerics = any> extends Endpoint {\n  /* Prepare fetch */\n  readonly path: string;\n  readonly urlPrefix: string;\n  readonly requestInit: RequestInit;\n  readonly method: string;\n  readonly signal: AbortSignal | undefined;\n  url(...args: Parameters<F>): string;\n  getRequestInit(\n    this: any,\n    body?: RequestInit['body'] | Record<string, unknown>,\n  ): RequestInit;\n  getHeaders(headers: HeadersInit): HeadersInit;\n\n  /* Perform/process fetch */\n  fetchResponse(input: RequestInfo, init: RequestInit): Promise<Response>;\n  parseResponse(response: Response): Promise<any>;\n  process(value: any, ...args: Parameters<F>): any;\n}\n"))),(0,r.kt)(o.Z,{value:"Endpoint",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"class Endpoint<F extends (...args: any) => Promise<any>> {\n  constructor(fetchFunction: F, options: EndpointOptions);\n\n  key(...args: Parameters<F>): string;\n\n  readonly sideEffect?: true;\n\n  readonly schema?: Schema;\n\n  /** Default data expiry length, will fall back to NetworkManager default if not defined */\n  readonly dataExpiryLength?: number;\n  /** Default error expiry length, will fall back to NetworkManager default if not defined */\n  readonly errorExpiryLength?: number;\n  /** Poll with at least this frequency in miliseconds */\n  readonly pollFrequency?: number;\n  /** Marks cached resources as invalid if they are stale */\n  readonly invalidIfStale?: boolean;\n  /** Enables optimistic updates for this request - uses return value as assumed network response */\n  readonly getOptimisticResponse?: (\n    snap: SnapshotInterface,\n    ...args: Parameters<F>\n  ) => ResolveType<F>;\n  /** Determines whether to throw or fallback to */\n  readonly errorPolicy?: (error: any) => 'soft' | undefined;\n}\n")))),(0,r.kt)("admonition",{title:"extends",type:"info"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("inlineCode",{parentName:"p"},"RestEndpoint")," extends ",(0,r.kt)("a",{parentName:"p",href:"/rest/6.0/api/Endpoint"},"Endpoint"))),(0,r.kt)("h2",{id:"usage"},"Usage"),(0,r.kt)("p",null,"All options are supported as arguments to the constructor, ",(0,r.kt)("a",{parentName:"p",href:"#extend"},"extend"),", and as overrides when using ",(0,r.kt)("a",{parentName:"p",href:"#inheritance"},"inheritance")),(0,r.kt)("h3",{id:"simplest-retrieval"},"Simplest retrieval"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const getTodo = new RestEndpoint({\n  path: 'https\\\\://jsonplaceholder.typicode.com/todos/:id',\n});\n")),(0,r.kt)("h3",{id:"managing-state"},"Managing state"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"export class Todo extends Entity {\n  id = '';\n  title = '';\n  completed = false;\n  pk() { return this.id }\n}\n\nconst getTodo = new RestEndpoint({\n  urlPrefix: 'https://jsonplaceholder.typicode.com'\n  path: '/todos/:id',\n  schema: Todo,\n});\nconst updateTodo = new RestEndpoint({\n  urlPrefix: 'https://jsonplaceholder.typicode.com',\n  path: '/todos/:id',\n  method: 'PUT',\n  schema: Todo,\n})\n")),(0,r.kt)("p",null,"Using a ",(0,r.kt)("a",{parentName:"p",href:"/rest/6.0/api/schema"},"Schema")," enables automatic data consistency without the need to hurt performance with refetching."),(0,r.kt)("h3",{id:"typing"},"Typing"),(0,r.kt)("h4",{id:"resolutionreturn"},"Resolution/Return"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"#schema"},"schema")," determines the return value when used with data-binding hooks like ",(0,r.kt)("a",{parentName:"p",href:"/docs/api/useSuspense"},"useSuspense"),", ",(0,r.kt)("a",{parentName:"p",href:"/docs/api/useDLE"},"useDLE")," or ",(0,r.kt)("a",{parentName:"p",href:"/docs/api/useCache"},"useCache")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const get = new RestEndpoint({ path: '/', schema: Todo });\n// todo is Todo\nconst todo = useSuspense(get);\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"#process"},"process")," determines the resolution value when the endpoint is called directly or\nwhen use with ",(0,r.kt)("a",{parentName:"p",href:"/docs/api/Controller#fetch"},"Controller.fetch"),". Otherwise this will be 'any' to\nensure compatibility."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"interface TodoInterface {\n  title: string;\n  completed: boolean;\n}\nconst get = new RestEndpoint({\n  path: '/',\n  process(value): TodoInterface {\n    return value;\n  },\n});\n// todo is TodoInterface\nconst todo = await get();\nconst todo2 = await controller.fetch(get);\n")),(0,r.kt)("h4",{id:"function-parameters"},"Function Parameters"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"#path"},"path")," used to construct the url determines the type of the first argument. If it has no patterns,\nthen the 'first' argument is skipped."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const get = new RestEndpoint({ path: '/' });\nget();\nconst getById = new RestEndpoint({ path: '/:id' });\n// both number and string types work as they are serialized into strings to construct the url\ngetById({ id: 5 });\ngetById({ id: '5' });\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"#method"},"method")," determines whether there is a second argument to be sent as the ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch#body"},"body"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const update = new RestEndpoint({ path: '/:id', method: 'PUT' });\nupdate({ id: 5 }, { title: 'updated', completed: true });\n")),(0,r.kt)("p",null,"However, this is typed as 'any' so it won't catch typos."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"body")," can be used to type the argument after the url parameters. It is only used for typing so the\nvalue sent does not matter. ",(0,r.kt)("inlineCode",{parentName:"p"},"undefined")," value can be used to 'disable' the second argument."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const update = new RestEndpoint({\n  path: '/:id',\n  method: 'PUT',\n  body: {} as TodoInterface,\n});\nupdate({ id: 5 }, { title: 'updated', completed: true });\n// `undefined` disables 'body' argument\nconst rpc = new RestEndpoint({\n  path: '/:id',\n  method: 'PUT',\n  body: undefined,\n});\nrpc({ id: 5 });\n")),(0,r.kt)("h2",{id:"fetch-lifecycle"},"Fetch Lifecycle"),(0,r.kt)("p",null,"RestEndpoint adds to Endpoint by providing customizations for a provided fetch method."),(0,r.kt)(l,{mdxType:"Lifecycle"}),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="fetch implementation for RestEndpoint"',title:'"fetch',implementation:!0,for:!0,'RestEndpoint"':!0},"function fetch(...args) {\n  const urlParams = this.#hasBody && args.length < 2 ? {} : args[0] || {};\n  const body = this.#hasBody ? args[args.length - 1] : undefined;\n  return this.fetchResponse(this.url(urlParams), this.getRequestInit(body))\n    .then(this.parseResponse)\n    .then(res => this.process(res, ...args));\n}\n")),(0,r.kt)("h2",{id:"prepare-fetch"},"Prepare Fetch"),(0,r.kt)("p",null,"Members double as options (second constructor arg). While none are required, the first few\nhave defaults."),(0,r.kt)("h3",{id:"url"},"url(params): string"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"urlPrefix")," + ",(0,r.kt)("inlineCode",{parentName:"p"},"path template")," + '?' + ",(0,r.kt)("inlineCode",{parentName:"p"},"searchParams")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"url()")," uses the ",(0,r.kt)("inlineCode",{parentName:"p"},"params")," to fill in the ",(0,r.kt)("a",{parentName:"p",href:"#path"},"path template"),". Any unused ",(0,r.kt)("inlineCode",{parentName:"p"},"params")," members are then used\nas ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/URL/searchParams"},"searchParams")," (aka 'GET' params - the stuff after ",(0,r.kt)("inlineCode",{parentName:"p"},"?"),")."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/URL/searchParams"},"searchParams")," (aka queryParams) are sorted to maintain determinism."),(0,r.kt)("details",{collapsed:!0},(0,r.kt)("summary",null,(0,r.kt)("b",null,"Implementation")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"url(urlParams = {}) {\n  const urlBase = getUrlBase(this.path)(urlParams);\n  const tokens = getUrlTokens(this.path);\n  const searchParams = {};\n  Object.keys(urlParams).forEach(k => {\n    if (!tokens.has(k)) {\n      searchParams[k] = urlParams[k];\n    }\n  });\n  if (Object.keys(searchParams).length) {\n    return `${this.urlPrefix}${urlBase}?${paramsToString(searchParams)}`;\n  }\n  return `${this.urlPrefix}${urlBase}`;\n}\n"))),(0,r.kt)("h3",{id:"path"},"path: string"),(0,r.kt)("p",null,"Uses ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/pillarjs/path-to-regexp#compile-reverse-path-to-regexp"},"path-to-regex")," to build\nurls using the parameters passed. This also informs the types so they are properly enforced."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},":")," prefixed words are key names. Both strings and numbers are accepted as options."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const getThing = new RestEndpoint({ path: '/:group/things/:id' });\ngetThing({ group: 'first', id: 77 });\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"?")," to indicate optional parameters"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const optional = new RestEndpoint({ path: '/:group/things/:number?' });\noptional({ group: 'first' });\noptional({ group: 'first', number: 'fifty' });\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\\\\")," to escape special characters like ",(0,r.kt)("inlineCode",{parentName:"p"},":")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"?")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const getSite = new RestEndpoint({ path: 'https\\\\://site.com/:slug' });\ngetSite({ slug: 'first' });\n")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Types are inferred automatically from ",(0,r.kt)("inlineCode",{parentName:"p"},"path"),"."),(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("inlineCode",{parentName:"p"},"body")," can be used to set a second argument for mutation endpoints. The actual value is not\nused in any way so it does not matter."),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const updateSite = new RestEndpoint({\n  path: 'https\\\\://site.com/:slug',\n  // highlight-next-line\n  body: {} as { url: string },\n});\n\nupdateSite({ slug: 'cool' }, { url: 'https://resthooks.io/' });\n"))),(0,r.kt)("h3",{id:"urlPrefix"},"urlPrefix: string = ''"),(0,r.kt)("p",null,"Prepends this to the compiled ",(0,r.kt)("a",{parentName:"p",href:"#path"},"path")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"For a dynamic prefix, try overriding the url() method:"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const getTodo = new RestEndpoint({\n  path: '/todo/:id',\n  url(...args) {\n    return dynamicPrefix() + super.url(...args);\n  },\n});\n"))),(0,r.kt)("h3",{id:"method"},"method: string = 'GET'"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Request/method"},"Method")," is part of the HTTP protocol.\nREST protocols use these to indicate the type of operation. Because of this RestEndpoint uses this\nto inform ",(0,r.kt)("inlineCode",{parentName:"p"},"sideEffect")," and whether the endpoint should use a ",(0,r.kt)("inlineCode",{parentName:"p"},"body")," payload."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"GET")," is 'readonly', other methods imply sideEffects."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"GET")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"DELETE")," both default to no ",(0,r.kt)("inlineCode",{parentName:"p"},"body"),"."),(0,r.kt)("admonition",{title:"How method affects function Parameters",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("inlineCode",{parentName:"p"},"method")," only influences parameters in the RestEndpoint constructor and ",(0,r.kt)("em",{parentName:"p"},"not")," ",(0,r.kt)("a",{parentName:"p",href:"#extend"},".extend()"),".\nThis allows non-standard method-body combinations."),(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("inlineCode",{parentName:"p"},"body")," will default to ",(0,r.kt)("inlineCode",{parentName:"p"},"any"),". You can always set body explicitly to take full control. ",(0,r.kt)("inlineCode",{parentName:"p"},"undefined")," can be used\nto indicate there is no body."),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const standardCreate = new RestEndpoint({\n  path: '/:id',\n  method: 'POST',\n});\nstandardCreate({ id }, myPayload);\nconst nonStandardEndpoint = new RestEndpoint({\n  path: '/:id',\n  method: 'POST',\n  body: undefined,\n});\n// no second 'body' argument, because body was set to 'undefined'\nnonStandardEndpoint({ id });\n"))),(0,r.kt)("h3",{id:"getRequestInit"},"getRequestInit(body): RequestInit"),(0,r.kt)("p",null,"Prepares ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch"},"RequestInit")," used in fetch.\nThis is sent to ",(0,r.kt)("a",{parentName:"p",href:"#fetchResponse"},"fetchResponse")),(0,r.kt)("h3",{id:"getHeaders"},"getHeaders(headers: HeadersInit): HeadersInit"),(0,r.kt)("p",null,"Called by ",(0,r.kt)("a",{parentName:"p",href:"#getRequestInit"},"getRequestInit")," to determine ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Request/headers"},"HTTP Headers")),(0,r.kt)("p",null,"This is often useful for ",(0,r.kt)("a",{parentName:"p",href:"../guides/auth"},"authentication")),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Don't use hooks here.")),(0,r.kt)("h2",{id:"handle-fetch"},"Handle fetch"),(0,r.kt)("h3",{id:"fetchResponse"},"fetchResponse(input, init): Promise"),(0,r.kt)("p",null,"Performs the ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API"},"fetch")," call"),(0,r.kt)("h3",{id:"parseResponse"},"parseResponse(response): Promise"),(0,r.kt)("p",null,"Takes the ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Response"},"Response")," and parses via .text() or .json()"),(0,r.kt)("h3",{id:"process"},"process(value, ...args): any"),(0,r.kt)("p",null,"Perform any transforms with the parsed result. Defaults to identity function."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"The return type of process can be used to set the return type of the endpoint fetch:"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const getTodo = new RestEndpoint({\n  path: '/todos/:id',\n  // The identity function is the default value; so we aren't changing any runtime behavior\n  // highlight-next-line\n  process(value): TodoInterface {\n    return value;\n  },\n});\n\ninterface TodoInterface {\n  id: string;\n  title: string;\n  completed: boolean;\n}\n")),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// title is string\nconst title = (await getTodo({ id })).title;\n"))),(0,r.kt)("h2",{id:"schema"},"schema?: Schema"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/rest/6.0/api/schema"},"Declarative data lifecycle")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Global data consistency and performance with ",(0,r.kt)("a",{parentName:"li",href:"https://www.plutora.com/blog/understanding-the-dry-dont-repeat-yourself-principle"},"DRY")," state: ",(0,r.kt)("a",{parentName:"li",href:"/rest/6.0/api/schema"},"where")," to expect ",(0,r.kt)("a",{parentName:"li",href:"/rest/6.0/api/Entity"},"Entities")),(0,r.kt)("li",{parentName:"ul"},"Classes to ",(0,r.kt)("a",{parentName:"li",href:"/rest/guides/network-transform#deserializing-fields"},"deserialize fields")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/rest/6.0/api/Entity#useincoming"},"Race condition handling")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/rest/6.0/api/Entity#validate"},"Validation")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/rest/6.0/api/Entity#expiresat"},"Expiry"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import { Entity, RestEndpoint } from '@rest-hooks/rest';\n\nclass User extends Entity {\n  readonly id: string = '';\n  readonly username: string = '';\n\n  pk() {\n    return this.id;\n  }\n}\n\nconst getUser = new RestEndpoint({\n  path: '/users/:id',\n  schema: User,\n});\n")),(0,r.kt)("h2",{id:"endpoint-life-cycles"},"Endpoint Life-Cycles"),(0,r.kt)("p",null,"These are inherited from ",(0,r.kt)("a",{parentName:"p",href:"/rest/6.0/api/Endpoint#lifecycle"},"Endpoint")),(0,r.kt)("h3",{id:"dataexpirylength"},"dataExpiryLength?: number"),(0,r.kt)("p",null,"Custom data cache lifetime for the fetched resource. Will override the value set in NetworkManager."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/getting-started/expiry-policy#expiry-time"},"Learn more about expiry time")),(0,r.kt)("h3",{id:"errorexpirylength"},"errorExpiryLength?: number"),(0,r.kt)("p",null,"Custom data error lifetime for the fetched resource. Will override the value set in NetworkManager."),(0,r.kt)("h3",{id:"errorpolicy"},"errorPolicy?: (error: any) => 'soft' | undefined"),(0,r.kt)("p",null,"'soft' will use stale data (if exists) in case of error; undefined or not providing option will result\nin error."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/getting-started/expiry-policy#error-policy"},"Learn more about errorPolicy")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"errorPolicy(error) {\n  return error.status >= 500 ? 'soft' : undefined;\n}\n")),(0,r.kt)("h3",{id:"invalidifstale"},"invalidIfStale: boolean"),(0,r.kt)("p",null,"Indicates stale data should be considered unusable and thus not be returned from the cache. This means\nthat useSuspense() will suspend when data is stale even if it already exists in cache."),(0,r.kt)("h3",{id:"pollfrequency"},"pollFrequency: number"),(0,r.kt)("p",null,"Frequency in millisecond to poll at. Requires using ",(0,r.kt)("a",{parentName:"p",href:"/docs/api/useSubscription"},"useSubscription()")," to have\nan effect."),(0,r.kt)("h3",{id:"getoptimisticresponse"},"getOptimisticResponse: (snap, ...args) => fakePayload"),(0,r.kt)("p",null,"When provided, any fetches with this endpoint will behave as though the ",(0,r.kt)("inlineCode",{parentName:"p"},"fakePayload")," return value\nfrom this function was a succesful network response. When the actual fetch completes (regardless\nof failure or success), the optimistic update will be replaced with the actual network response."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/rest/6.0/guides/optimistic-updates"},"Optimistic update guide")),(0,r.kt)("h3",{id:"update"},"update(normalizedResponseOfThis, ...args) => ({ ","[endpointKey]",": (normalizedResponseOfEndpointToUpdate) => updatedNormalizedResponse) })"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="UpdateType.ts"',title:'"UpdateType.ts"'},"type UpdateFunction<\n  Source extends EndpointInterface,\n  Updaters extends Record<string, any> = Record<string, any>,\n> = (\n  source: ResultEntry<Source>,\n  ...args: Parameters<Source>\n) => { [K in keyof Updaters]: (result: Updaters[K]) => Updaters[K] };\n")),(0,r.kt)("p",null,"Simplest case:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="userEndpoint.ts"',title:'"userEndpoint.ts"'},"const createUser = new RestEndpoint({\n  path: '/user',\n  method: 'POST',\n  schema: User,\n  update: (newUserId: string) => ({\n    [userList.key()]: (users = []) => [newUserId, ...users],\n  }),\n});\n")),(0,r.kt)("p",null,"More updates:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Component.tsx"',title:'"Component.tsx"'},"const allusers = useSuspense(userList);\nconst adminUsers = useSuspense(userList, { admin: true });\n")),(0,r.kt)("p",null,"The endpoint below ensures the new user shows up immediately in the usages above."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="userEndpoint.ts"',title:'"userEndpoint.ts"'},"const createUser = new RestEndpoint({\n  path: '/user',\n  method: 'POST',\n  schema: User,\n  update: (newUserId, newUser)  => {\n    const updates = {\n      [userList.key()]: (users = []) => [newUserId, ...users],\n    ];\n    if (newUser.isAdmin) {\n      updates[userList.key({ admin: true })] = (users = []) => [newUserId, ...users];\n    }\n    return updates;\n  },\n});\n")),(0,r.kt)("p",null,"This is usage with a ",(0,r.kt)("a",{parentName:"p",href:"/rest/6.0/api/createResource"},"createResource")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="TodoResource.ts"',title:'"TodoResource.ts"'},"import { Entity, createResource } from '@rest-hooks/rest';\n\nexport class Todo extends Entity {\n  readonly id: number = 0;\n  readonly userId: number = 0;\n  readonly title: string = '';\n  readonly completed: boolean = false;\n\n  pk() {\n    return `${this.id}`;\n  }\n}\n\n// We declare BaseTodoResource before TodoResource to prevent recursive type definitions\nconst BaseTodoResource = createResource({\n  path: 'https://jsonplaceholder.typicode.com/todos/:id',\n  schema: Todo,\n});\nexport const TodoResource = {\n  ...BaseTodoResource,\n  create: BaseTodoResource.create.extend({\n    // highlight-start\n    update: (newResourceId: string) => ({\n      [todoList.key({})]: (resourceIds: string[] = []) => [\n        ...resourceIds,\n        newResourceId,\n      ],\n    }),\n    // highlight-end\n  }),\n};\n")),(0,r.kt)("h2",{id:"extend"},"extend(options): Endpoint"),(0,r.kt)("p",null,"Can be used to further customize the endpoint definition"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"const getUser = new RestEndpoint({ path: '/users/:id' });\n\nconst UserDetailNormalized = getUser.extend({\n  schema: User,\n  getHeaders(headers: HeadersInit): HeadersInit {\n    return {\n      ...headers,\n      'Access-Token': getAuth(),\n    };\n  },\n});\n")),(0,r.kt)("h2",{id:"paginated"},"paginated(removeCursor): args"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"function paginated<E, A extends any[]>(\n  this: E,\n  removeCursor: (...args: A) => readonly [...Parameters<E>],\n): PaginationEndpoint<E, A>;\n")),(0,r.kt)("p",null,"Extends an endpoint whose schema contains an Array and creates a new endpoint that\nwill append the items it finds into the list from the first endpoint. See ",(0,r.kt)("a",{parentName:"p",href:"/rest/6.0/guides/pagination#infinite-scrolling"},"Infinite Scrolling Pagination")," for more info."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const getNextPage = getList.paginated(\n  ({ cursor, ...rest }: { cursor: string | number }) =>\n    (Object.keys(rest).length ? [rest] : []) as any,\n);\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"removeCusor")," is a function that takes the arguments sent in fetch of ",(0,r.kt)("inlineCode",{parentName:"p"},"getNextPage")," and returns\nthe arguments to update ",(0,r.kt)("inlineCode",{parentName:"p"},"getList"),"."),(0,r.kt)("h2",{id:"inheritance"},"Inheritance"),(0,r.kt)("p",null,"Make sure you use ",(0,r.kt)("inlineCode",{parentName:"p"},"RestGenerics")," to keep types working."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { RestEndpoint, RestGenerics } from '@rest-hooks/rest';\n\nclass GithubEndpoint<O extends RestGenerics = any> extends RestEndpoint<O> {\n  urlPrefix = 'https://api.github.com';\n\n  getHeaders(headers: HeadersInit): HeadersInit {\n    return {\n      ...headers,\n      'Access-Token': getAuth(),\n    };\n  }\n}\n")))}f.isMDXComponent=!0},30433:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(67294),r=n(86010),s="tabItem_Ymn6";function o(e){let{children:t,hidden:n,className:o}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(s,o),hidden:n},t)}},22808:(e,t,n)=>{n.d(t,{Z:()=>E});var a=n(87462),r=n(67294),s=n(86010),o=n(63735),i=n(76775),l=n(34423),p=n(20636),d=n(99200);function u(e){return function(e){return r.Children.map(e,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:r}}=e;return{value:t,label:n,attributes:a,default:r}}))}function c(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=t??u(n);return function(e){const t=(0,p.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function h(e){let{queryString:t=!1,groupId:n}=e;const a=(0,i.k6)(),s=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l._X)(s),(0,r.useCallback)((e=>{if(!s)return;const t=new URLSearchParams(a.location.search);t.set(s,e),a.replace({...a.location,search:t.toString()})}),[s,a])]}function f(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,s=c(e),[o,i]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:s}))),[l,p]=h({queryString:n,groupId:a}),[u,f]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,s]=(0,d.Nk)(n);return[a,(0,r.useCallback)((e=>{n&&s.set(e)}),[n,s])]}({groupId:a}),g=(()=>{const e=l??u;return m({value:e,tabValues:s})?e:null})();(0,r.useEffect)((()=>{g&&i(g)}),[g]);return{selectedValue:o,selectValue:(0,r.useCallback)((e=>{if(!m({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);i(e),p(e),f(e)}),[p,f,s]),tabValues:s}}var g=n(5730),k="tabList__CuJ",y="tabItem_LNqP";function b(e){let{className:t,block:n,selectedValue:i,selectValue:l,tabValues:p}=e;const d=[],{blockElementScrollPositionUntilNextRender:u}=(0,o.o5)(),c=e=>{const t=e.currentTarget,n=d.indexOf(t),a=p[n].value;a!==i&&(u(t),l(a))},m=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=d.indexOf(e.currentTarget)+1;t=d[n]??d[0];break}case"ArrowLeft":{const n=d.indexOf(e.currentTarget)-1;t=d[n]??d[d.length-1];break}}t?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":n},t)},p.map((e=>{let{value:t,label:n,attributes:o}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:i===t?0:-1,"aria-selected":i===t,key:t,ref:e=>d.push(e),onKeyDown:m,onClick:c},o,{className:(0,s.Z)("tabs__item",y,o?.className,{"tabs__item--active":i===t})}),n??t)})))}function v(e){let{lazy:t,children:n,selectedValue:a}=e;if(t){const e=n.find((e=>e.props.value===a));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},n.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function N(e){const t=f(e);return r.createElement("div",{className:(0,s.Z)("tabs-container",k)},r.createElement(b,(0,a.Z)({},e,t)),r.createElement(v,(0,a.Z)({},e,t)))}function E(e){const t=(0,g.Z)();return r.createElement(N,(0,a.Z)({key:String(t)},e))}},3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),c=p(n),m=r,h=c["".concat(l,".").concat(m)]||c[m]||u[m]||s;return n?a.createElement(h,o(o({ref:t},d),{},{components:n})):a.createElement(h,o({ref:t},d))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,o=new Array(s);o[0]=c;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var p=2;p<s;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"}}]);