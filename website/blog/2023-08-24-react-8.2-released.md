---
title: 8.2 - fetchIfStale, expireAll, FormData with Collections
authors: [ntucker]
tags: [releases, rest-hooks, packages, controller]
---

In 8.1 and 8.2 we added two new [controller](/docs/api/Controller) methods, along
with some improvements to edge cases for [Collections](/rest/api/Collection)

- [Controller.expireAll()](/blog/2023/08/24/react-8.2-released#controllerexpireall) - refresh data while continuing to show stale data
- [Controller.fetchIfStale()](/blog/2023/08/24/react-8.2-released#controllerfetchifstale) - fetch data only if it is marked as expired
- Collections filtering support [FormData arguments](/blog/2023/08/24/react-8.2-released#collections-and-formdata).

<!--truncate-->

import StackBlitz from '@site/src/components/StackBlitz';

### Controller.expireAll

Similar to use case of [invalidateAll()](/docs/api/Controller#invalidateAll), but does not result in loading condition.

[controller.expireAll()](https://dataclient.io/docs/api/Controller#expireAll) sets all responses' [expiry status](/docs/concepts/expiry-policy) matching `testKey` to [Stale](/docs/concepts/expiry-policy#stale).

This is sometimes useful to trigger refresh of only data presently shown
when there are many parameterizations in cache.

```tsx
import { type Controller, useController } from '@data-client/react';

const createTradeHandler = (ctrl: Controller) => async trade => {
  await ctrl.fetch(TradeResource.getList.push({ user: user.id }, trade));
  // highlight-start
  ctrl.expireAll(AccountResource.get);
  ctrl.expireAll(AccountResource.getList);
  // highlight-end
};

function CreateTrade({ id }: { id: string }) {
  const handleTrade = createTradeHandler(useController());

  return (
    <Form onSubmit={handleTrade}>
      <FormField name="ticker" />
      <FormField name="amount" type="number" />
      <FormField name="price" type="number" />
    </Form>
  );
}
```

[Controller.expireAll() PR](https://github.com/reactive/data-client/pull/2738)

### Controller.fetchIfStale

[controller.fetchIfStale()](https://dataclient.io/docs/api/Controller#fetchIfStale) fetches only if endpoint is considered '[stale](/docs/concepts/expiry-policy#stale)'.

This can be useful when prefetching data, as it avoids overfetching fresh data.

An [example](https://stackblitz.com/github/reactive/data-client/tree/master/examples/github-app?file=src%2Frouting%2Froutes.tsx) with a fetch-as-you-render router:

```ts
{
  name: 'IssueList',
  component: lazyPage('IssuesPage'),
  title: 'issue list',
  resolveData: async (
    controller: Controller,
    { owner, repo }: { owner: string; repo: string },
    searchParams: URLSearchParams,
  ) => {
    const q = searchParams?.get('q') || 'is:issue is:open';
    // highlight-start
    await controller.fetchIfStale(IssueResource.search, {
      owner,
      repo,
      q,
    });
    // highlight-end
  },
},
```

<StackBlitz app="github-app" file="src/routing/routes.tsx" view="editor" branch="master" />

#### Stale

```tsx
Date.now() <= expiresAt && expiryStatus !== ExpiryStatus.Invalid
```

[Controller.fetchIfStale() PR](https://github.com/reactive/data-client/pull/2743)


### Collections and FormData

[Collections](/rest/api/Collection) can filter based on FormData arguments

```ts
ctrl.fetch(
  getPosts.push,
  { group: 'react' },
  new FormData(e.currentTarget),
);
```

Say our FormData contained an `author` field. Now that newly created
item will be properly added to the [collection list](/rest/api/Collection) for that author.

```ts
useSuspense(getPosts, {
  group: 'react',
  author: 'bob',
});
```

In this case if `FormData.get('author') === 'bob'`, it will show
up in that [useSuspense()](/docs/api/useSuspense) call.

See more in the [Collection nonFilterArgumentKeys example](https://dataclient.io/rest/api/Collection#nonfilterargumentkeys)

[Collections can filter based on FormData arguments PR](https://github.com/reactive/data-client/pull/2771)

